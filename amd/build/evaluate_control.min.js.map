{"version":3,"sources":["../src/evaluate_control.js"],"names":["define","$","Log","Templates","Ajax","Str","FeditorHelper","EvaluateControl","criteria","self","prototype","main","setupEvents","forEach","element","criterion","document","getElementById","criteriaid","level","children","Array","from","leveldetails","descriptorsCollection","descriptors","descriptor","HTMLInputElement","addEventListener","clickDescriptorHandler","bind","e","debug","id","target","split","criteriaID","levelID","descriptorID","length","levelsInput","JSON","parse","getLevelsJSON","levelDescriptors","filter","descriptorid","checked","value","stringify","init","data","control"],"mappings":"AAwBAA,OAAM,wCAAC,CAAC,QAAD,CAAW,UAAX,CAAuB,gBAAvB,CAAyC,WAAzC,CAAsD,UAAtD,CAAkE,oCAAlE,CAAD,CACF,SAAUC,CAAV,CAAaC,CAAb,CAAkBC,CAAlB,CAA6BC,CAA7B,CAAmCC,CAAnC,CAAwCC,CAAxC,CAAuD,CACnD,aAUA,QAASC,CAAAA,CAAT,CAAyBC,CAAzB,CAAmC,CAC/B,GAAMC,CAAAA,CAAI,CAAG,IAAb,CACAA,CAAI,CAACD,QAAL,CAAgBA,CACnB,CAEDD,CAAe,CAACG,SAAhB,CAA0BC,IAA1B,CAAiC,UAAY,CACzC,GAAMF,CAAAA,CAAI,CAAG,IAAb,CACAA,CAAI,CAACG,WAAL,CAAiBH,CAAI,CAACD,QAAtB,CAEH,CAJD,CAMAD,CAAe,CAACG,SAAhB,CAA0BE,WAA1B,CAAwC,SAAUJ,CAAV,CAAoB,CACxD,GAAMC,CAAAA,CAAI,CAAG,IAAb,CAEAD,CAAQ,CAACK,OAAT,CAAiB,SAAUC,CAAV,CAAmB,IAC1BL,CAAAA,CAAI,CAAG,IADmB,CAE1BM,CAAS,CAAGC,QAAQ,CAACC,cAAT,4CAA4DH,CAAO,CAACI,UAApE,EAFc,CAG1BC,CAAK,CAAGJ,CAAS,CAACK,QAAV,CAAmB,CAAnB,EAAsBA,QAHJ,CAQhCC,KAAK,CAACC,IAAN,CAAWH,CAAX,EAAkBN,OAAlB,CAA0B,SAAUU,CAAV,CAAwB,IAKxCC,CAAAA,CAAqB,CAAGD,CAAY,CAACH,QAAb,CAAsB,CAAtB,CALgB,CAMxCK,CAAW,CAAGD,CAAqB,CAACJ,QANI,CAO9CC,KAAK,CAACC,IAAN,CAAWG,CAAX,EAAwBZ,OAAxB,CAAgC,SAAUa,CAAV,CAAsB,CAGlD,GAAIA,CAAU,WAAYC,CAAAA,gBAA1B,CAA4C,CACxCD,CAAU,CAACE,gBAAX,CAA4B,OAA5B,CAAqCnB,CAAI,CAACoB,sBAAL,CAA4BC,IAA5B,CAAiCrB,CAAjC,CAArC,CACH,CACJ,CAND,CAOH,CAdD,CAcGA,CAdH,CAiBH,CAzBD,CAyBGA,CAzBH,CA4BH,CA/BD,CAiCAF,CAAe,CAACG,SAAhB,CAA0BmB,sBAA1B,CAAmD,SAAUE,CAAV,CAAa,CAC/C,IAD+C,CAG5D7B,CAAG,CAAC8B,KAAJ,CAAU,YAAV,EACA9B,CAAG,CAAC8B,KAAJ,CAAUD,CAAV,EAJ4D,GAKtDE,CAAAA,CAAE,CAAIF,CAAC,CAACG,MAAF,CAASD,EAAV,CAAcE,KAAd,CAAoB,GAApB,CALiD,CAMtDC,CAAU,CAAGH,CAAE,CAAC,CAAD,CANuC,CAOtDI,CAAO,CAAGJ,CAAE,CAAC,CAAD,CAP0C,CAQtDK,CAAY,CAAGL,CAAE,CAAEA,CAAE,CAACM,MAAH,CAAY,CAAd,CARqC,CAStDC,CAAW,CAAGC,IAAI,CAACC,KAAL,CAAWpC,CAAa,CAACqC,aAAd,CAA4BP,CAA5B,CAAX,CATwC,CAU5DlC,CAAG,CAAC8B,KAAJ,CAAUI,CAAV,EACAlC,CAAG,CAAC8B,KAAJ,CAAUK,CAAV,EACAnC,CAAG,CAAC8B,KAAJ,CAAUM,CAAV,EAGA,GAAMM,CAAAA,CAAgB,CAAGJ,CAAW,CAACH,CAAD,CAAX,CAAqBZ,WAA9C,CACAvB,CAAG,CAAC8B,KAAJ,CAAUY,CAAV,EAEAA,CAAgB,CAACC,MAAjB,CAAwB,SAAAnB,CAAU,CAAI,CAClC,GAAIA,CAAU,CAACoB,YAAX,EAA2BR,CAA/B,CAA6C,CACzCZ,CAAU,CAACqB,OAAX,CAAqB,CAACrB,CAAU,CAACqB,OACpC,CACJ,CAJD,CAIGT,CAJH,EAOApC,CAAG,CAAC8B,KAAJ,CAAUQ,CAAV,EAIAxB,QAAQ,CAACC,cAAT,mCAAmDmB,CAAnD,gBAA2EY,KAA3E,CAAmFP,IAAI,CAACQ,SAAL,CAAeT,CAAf,CACtF,CA9BD,CAmCA,MAAO,CACHU,IAAI,CAxFR,SAAcC,CAAd,CAAoB,CAEhBjD,CAAG,CAAC8B,KAAJ,CAAU,0CAAV,EACAmB,CAAI,CAAGV,IAAI,CAACC,KAAL,CAAWS,CAAX,CAAP,CACA,GAAMC,CAAAA,CAAO,CAAG,GAAI7C,CAAAA,CAAJ,CAAoB4C,CAAI,CAAC3C,QAAzB,CAAhB,CACA4C,CAAO,CAACzC,IAAR,CAAawC,CAAI,CAAC3C,QAAlB,CACH,CAiFM,CAGV,CA9FC,CAAN","sourcesContent":["/* eslint-disable max-len */\n/* eslint-disable promise/always-return */\n// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n\n/**\n * @package   gradingform_frubric\n * @copyright 2021 Veronica Bermegui\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/log', 'core/templates', 'core/ajax', 'core/str', 'gradingform_frubric/feditor_helper'],\n    function ($, Log, Templates, Ajax, Str, FeditorHelper) {\n        'use strict';\n\n        function init(data) {\n\n            Log.debug(\"gradingform_frubric: Evaluate Control...\");\n            data = JSON.parse(data);\n            const control = new EvaluateControl(data.criteria);\n            control.main(data.criteria);\n        }\n\n        function EvaluateControl(criteria) {\n            const self = this;\n            self.criteria = criteria;\n        }\n\n        EvaluateControl.prototype.main = function () {\n            const self = this;\n            self.setupEvents(self.criteria);\n\n        }\n\n        EvaluateControl.prototype.setupEvents = function (criteria) {\n            const self = this;\n\n            criteria.forEach(function (element) {\n                const self = this;\n                const criterion = document.getElementById(`advancedgrading-frubric-criteria-${element.criteriaid}`);\n                const level = criterion.children[0].children;\n                // Log.debug(\"criteria.forEach\");\n                // Log.debug(self);\n               // Log.debug(FeditorHelper.getLevelsJSON(element.criteriaid));\n            //    self.levelsJSON = JSON.parse(FeditorHelper.getLevelsJSON(element.criteriaid));\n                Array.from(level).forEach(function (leveldetails) {\n                //   Log.debug(\"Array.from(level).forEach\");\n                //   Log.debug(self);\n                    // Log.debug(\"levelsJSON\");\n                    // Log.debug(self.levelsJSON);\n                    const descriptorsCollection = leveldetails.children[1];\n                    const descriptors = descriptorsCollection.children;\n                    Array.from(descriptors).forEach(function (descriptor) {\n                        // Log.debug(\"criteriaid\");\n                        // Log.debug(element.criteriaid);\n                        if (descriptor instanceof HTMLInputElement) {\n                            descriptor.addEventListener('click', self.clickDescriptorHandler.bind(self));\n                        }\n                    });\n                }, self);\n\n\n            }, self);\n\n\n        }\n\n        EvaluateControl.prototype.clickDescriptorHandler = function (e) {\n            const self = this;\n            \n            Log.debug(\"CHECKED...\");\n            Log.debug(e);\n            const id = (e.target.id).split('-');\n            const criteriaID = id[3];\n            const levelID = id[5];\n            const descriptorID = id [id.length - 1];\n            const levelsInput = JSON.parse(FeditorHelper.getLevelsJSON(criteriaID));\n            Log.debug(criteriaID);\n            Log.debug(levelID);\n            Log.debug(descriptorID);\n           \n\n            const levelDescriptors = levelsInput[levelID].descriptors;\n            Log.debug(levelDescriptors)\n\n            levelDescriptors.filter(descriptor => {\n                if (descriptor.descriptorid == descriptorID) {\n                    descriptor.checked = !descriptor.checked;\n                }\n            }, descriptorID);\n\n         \n            Log.debug(levelsInput);\n\n            // Replace the json value with the updated one\n\n            document.getElementById(`advancedgrading-frubric-${criteriaID}-leveljson`).value = JSON.stringify(levelsInput);\n        }\n\n\n\n\n        return {\n            init: init\n        };\n    });"],"file":"evaluate_control.min.js"}