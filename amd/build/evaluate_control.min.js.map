{"version":3,"sources":["../src/evaluate_control.js"],"names":["define","$","Log","Templates","Ajax","Str","FeditorHelper","EvaluateControl","criteria","self","totalScore","definitionID","document","getElementById","getAttribute","prototype","main","setupEvents","value","forEach","element","criterion","criteriaid","level","children","Array","from","leveldetails","descriptorsCollection","descriptors","descriptor","HTMLInputElement","type","addEventListener","clickDescriptorHandler","bind","e","debug","id","target","split","criteriaID","levelID","descriptorID","length","levelsInput","JSON","parse","getLevelsJSON","definition","replace","levelDescriptors","filter","descriptorid","checked","stringify","onblurScoreHandler","s","score","parseFloat","clickEvaluationHandler","currentScore","onChangeEvaluationHandler","init","data","control"],"mappings":"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","sourcesContent":["/* eslint-disable max-len */\n/* eslint-disable promise/always-return */\n// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n\n/**\n * @package   gradingform_frubric\n * @copyright 2021 Veronica Bermegui\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/log', 'core/templates', 'core/ajax', 'core/str', 'gradingform_frubric/feditor_helper'],\n    function ($, Log, Templates, Ajax, Str, FeditorHelper) {\n        'use strict';\n\n        function init(data) {\n\n            Log.debug(\"gradingform_frubric: Evaluate Control...\");\n            data = JSON.parse(data);\n            const control = new EvaluateControl(data.criteria);\n            control.main(data.criteria);\n        }\n\n        function EvaluateControl(criteria) {\n            const self = this;\n            self.criteria = criteria;\n            self.totalScore = 0.00;\n            self.definitionID = document.getElementById('advancedgrading-criteria').getAttribute('data-definition-id');\n        }\n\n        EvaluateControl.prototype.main = function () {\n            const self = this;\n            self.setupEvents(self.criteria);\n            document.getElementById(`advancedgrading-${self.definitionID}-frubric-total-grade`).value = self.totalScore;\n        }\n\n        EvaluateControl.prototype.setupEvents = function (criteria) {\n            const self = this;\n\n\n            criteria.forEach(function (element) {\n                const self = this;\n                const criterion = document.getElementById(`advancedgrading-frubric-criteria-${element.criteriaid}`);\n                const level = criterion.children[0].children;\n                \n                Array.from(level).forEach(function (leveldetails) {\n                    const descriptorsCollection = leveldetails.children[1];\n                    const descriptors = descriptorsCollection.children;\n                    Array.from(descriptors).forEach(function (descriptor) {\n\n                        if (descriptor instanceof HTMLInputElement) {\n                            switch (descriptor.type) {\n                                case 'checkbox':\n                                    descriptor.addEventListener('click', self.clickDescriptorHandler.bind(self));\n                                    break;\n                                case 'number':\n                                    // Log.debug(descriptor);\n                                    // Log.debug(self.totalScore);\n                                    // Log.debug(parseFloat(descriptor.value).toFixed(2));\n                                    // self.totalScore += parseFloat(descriptor.value);\n                                   // descriptor.addEventListener('click', self.clickEvaluationHandler.bind(this, self));\n                                    //descriptor.addEventListener('blur', self.onblurScoreHandler.bind(this, self));\n                                    break;\n                            }\n                        }\n                    });\n                }, self);\n\n            }, self);\n\n        }\n\n        EvaluateControl.prototype.clickDescriptorHandler = function (e) {\n            const self = this;\n\n            Log.debug(\"CHECKED...\");\n            Log.debug(e);\n            const id = (e.target.id).split('-');\n            const criteriaID = id[3];\n            const levelID = id[5];\n            const descriptorID = id[id.length - 1];\n            let levelsInput = JSON.parse(FeditorHelper.getLevelsJSON(criteriaID));\n            // Log.debug(criteriaID);\n            // Log.debug(levelID);\n            // Log.debug(descriptorID);\n            levelsInput[levelID].definition.replace(/\\\\/g, ''); // Remove the //  from the string. \n            let definition = JSON.parse(levelsInput[levelID].definition);\n            const levelDescriptors = levelsInput[levelID].descriptors;\n\n            levelDescriptors.filter(descriptor => {\n                if (descriptor.descriptorid == descriptorID) {\n                    descriptor.checked = !descriptor.checked;\n                }\n            }, descriptorID);\n\n            definition.descriptors = levelDescriptors;\n            definition = JSON.stringify(definition);\n\n            levelsInput[levelID].definition = definition;\n\n            // Log.debug(levelsInput)\n            // Replace the json value with the updated one\n            document.getElementById(`advancedgrading-frubric-${criteriaID}-leveljson`).value = JSON.stringify(levelsInput);\n        }\n\n        EvaluateControl.prototype.onblurScoreHandler = function (s, e) {\n\n            Log.debug(\"onblurScoreHandler\");\n            Log.debug(s);\n\n            const score = parseFloat(document.getElementById(e.target.id).value);\n            Log.debug(score);\n            s.totalScore = s.totalScore + score;\n            Log.debug(s.totalScore);\n            document.getElementById(`advancedgrading-${s.definitionID}-frubric-total-grade`).value = s.totalScore;\n        }\n\n        // TODO: recalculate Sum evalution values to display in total.\n        EvaluateControl.prototype.clickEvaluationHandler = function (s, e) {\n            Log.debug(\"clickEvaluationHandler\");\n          //  Log.debug(e);\n            s.currentScore = parseFloat(document.getElementById(e.target.id).value);\n            s.totalScore = parseFloat(document.getElementById(`advancedgrading-${s.definitionID}-frubric-total-grade`).value);\n                       \n            document.getElementById(e.target.id).addEventListener('change', s.onChangeEvaluationHandler.bind(this, s));\n            //document.getElementById(e.target.id).addEventListener('blur', s.onblurScoreHandler.bind(this, s));\n            Log.debug(s);\n\n            \n        }\n\n        EvaluateControl.prototype.onChangeEvaluationHandler = function (s, e) {\n            Log.debug(\"onChangeEvaluationHandler\");\n            //Log.debug(e);\n            s.totalScore = s.totalScore - s.currentScore;\n            s.totalScore = s.totalScore + parseFloat(document.getElementById(e.target.id).value);\n            document.getElementById(`advancedgrading-${s.definitionID}-frubric-total-grade`).value = s.totalScore;\n            s.currentScore = 0;\n            Log.debug(s);\n\n        }\n\n\n\n\n        return {\n            init: init\n        };\n    });"],"file":"evaluate_control.min.js"}