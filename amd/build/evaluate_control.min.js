define ("gradingform_frubric/evaluate_control",["core/log","gradingform_frubric/feditor_helper"],function(a,b){'use strict';function c(a){var b=this;b.criteria=a;b.definitionID=document.getElementById("advancedgrading-criteria").getAttribute("data-definition-id")}c.prototype.main=function(){var a=this;a.setupEvents(a.criteria)};c.prototype.setupEvents=function(a){var b=this;a.forEach(function(a){var b=this,c=document.getElementById("advancedgrading-frubric-criteria-".concat(a.criteriaid)),d=c.children[0].children,e=document.getElementById("advancedgrading-frubric-criteria-".concat(a.criteriaid,"-level-grade"));e.addEventListener("focus",b.focusEvaluationHandler.bind(this,b));Array.from(d).forEach(function(a){var c=a.children[1],d=c.children;Array.from(d).forEach(function(a){if(a instanceof HTMLInputElement){switch(a.type){case"checkbox":a.addEventListener("click",b.clickDescriptorHandler.bind(b));break;}}})},b)},b);var c=document.getElementById("advancedgrading-".concat(b.definitionID,"-frubric-total-grade"));c.addEventListener("focus",b.focusEvaluationTotalHandler.bind(this,b))};c.prototype.clickDescriptorHandler=function(c){a.debug("CHECKED...");var d=c.target.id.split("-"),e=d[3],f=d[5],g=d[d.length-1],h=JSON.parse(b.getLevelsJSON(e));h[f].definition.replace(/\\/g,"");var i=JSON.parse(h[f].definition),j=h[f].descriptors,k=[];j.forEach(function(a){k.push(a.descriptorid)},k);if(-1==k.indexOf(parseInt(g))){var l=document.getElementById("advancedgrading-frubric-criteria-".concat(e,"-level-").concat(f,"-descriptor-").concat(g)).nextSibling.textContent;j.push({checked:!1,descText:l,delete:0,descriptorid:g})}j.filter(function(a){if(a.descriptorid==g){a.checked=!a.checked}},g);i.descriptors=j;i=JSON.stringify(i);h[f].definition=i;document.getElementById("advancedgrading-frubric-".concat(e,"-leveljson")).value=JSON.stringify(h)};c.prototype.focusEvaluationHandler=function(b,c){a.debug("focusEvaluationHandler");document.getElementById(c.target.id).addEventListener("change",b.onChangeEvaluationHandler.bind(this,b))};c.prototype.onChangeEvaluationHandler=function(b,c){a.debug("onChangeEvaluationHandler");c.target.classList.remove("total-input-error");var d=parseFloat(document.getElementById(c.target.id).value),e=document.getElementById(c.target.id+"-out-of-value").innerText.split("/");e=parseFloat(e[e.length-1]);if(d>e||0>d){c.target.classList.add("total-input-error")}};c.prototype.focusEvaluationTotalHandler=function(a,b){document.getElementById(b.target.id).addEventListener("change",a.onChangeTotalEvaluationHandler.bind(this,a))};c.prototype.onChangeTotalEvaluationHandler=function(a,b){b.target.classList.remove("total-input-error");var c=parseFloat(document.getElementById(b.target.id).value),d=document.getElementById(b.target.id+"-given").innerText.split("/");d=parseFloat(d[d.length-1]);if(c>d){b.target.classList.add("total-input-error")}};return{init:function(b){a.debug("gradingform_frubric: Evaluate Control...");b=JSON.parse(b);var d=new c(b.criteria);d.main(b.criteria)}}});
//# sourceMappingURL=evaluate_control.min.js.map
