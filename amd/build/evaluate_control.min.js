define ("gradingform_frubric/evaluate_control",["core/log","gradingform_frubric/feditor_helper"],function(a,b){'use strict';function c(a){var b=this;b.criteria=a;b.definitionID=document.getElementById("advancedgrading-criteria").getAttribute("data-definition-id")}c.prototype.main=function(){var a=this;a.setupEvents(a.criteria)};c.prototype.setupEvents=function(a){var b=this;a.forEach(function(a){var b=this,c=document.getElementById("advancedgrading-frubric-criteria-".concat(a.criteriaid)),d=c.children[0].children,e=document.getElementById("advancedgrading-frubric-criteria-".concat(a.criteriaid,"-level-grade"));e.addEventListener("focus",b.focusEvaluationHandler.bind(this,b));Array.from(d).forEach(function(a){var c=a.children[1],d=c.children;Array.from(d).forEach(function(a){if(a instanceof HTMLInputElement){switch(a.type){case"checkbox":a.addEventListener("click",b.clickDescriptorHandler.bind(b));break;}}})},b)},b)};c.prototype.clickDescriptorHandler=function(a){var c=a.target.id.split("-"),d=c[3],e=c[5],f=c[c.length-1],g=JSON.parse(b.getLevelsJSON(d));g[e].definition.replace(/\\/g,"");var h=JSON.parse(g[e].definition),i=g[e].descriptors,j=[];i.forEach(function(a){j.push(a.descriptorid)},j);if(-1==j.indexOf(parseInt(f))){var k=document.getElementById("advancedgrading-frubric-criteria-".concat(d,"-level-").concat(e,"-descriptor-").concat(f)).nextSibling.textContent;i.push({checked:!1,descText:k,delete:0,descriptorid:f})}i.filter(function(a){if(a.descriptorid==f){a.checked=!a.checked}},f);h.descriptors=i;h=JSON.stringify(h);g[e].definition=h;document.getElementById("advancedgrading-frubric-".concat(d,"-leveljson")).value=JSON.stringify(g);document.getElementById("advancedgrading-frubric-".concat(d,"-leveljsonaux")).value=JSON.stringify(g)};c.prototype.focusEvaluationHandler=function(a,b){document.getElementById(b.target.id).addEventListener("change",a.onChangeEvaluationHandler.bind(this,a));document.getElementById(b.target.id).addEventListener("change",a.sumTotal.bind(this,a))};c.prototype.onChangeEvaluationHandler=function(a,b){b.target.classList.remove("total-input-error");var c=parseFloat(document.getElementById(b.target.id).value),d=document.getElementById(b.target.id+"-out-of-value").innerText.split("/");d=parseFloat(d[d.length-1]);if(c>d||0>c){b.target.classList.add("total-input-error")}else{document.getElementById(b.target.id).value=c}};c.prototype.sumTotal=function(){var a=document.getElementById("advancedgrading-criteria").querySelectorAll(".total-input"),b=0,c=!1,d=0;a.forEach(function(a,e){if(!a.classList.contains("result")&&!a.classList.contains("total-input-error")){b+=parseFloat(a.value)}if(a.classList.contains("result")){d=e}if(a.classList.contains("total-input-error")){c=!0}});var e=parseFloat(a[d].getAttribute("max"));if(!c&&b<=e){a[d].value=b}};return{init:function(a){a=JSON.parse(a);var b=new c(a.criteria);b.main(a.criteria)}}});
//# sourceMappingURL=evaluate_control.min.js.map
