define(["gradingform_frubric/feditor_helper"],function(d){"use strict";function e(){this.criteria=JSON.parse(document.querySelector(".form-frubric-evaluate").getAttribute("data-criteria")).criteria,this.definitionID=document.getElementById("advancedgrading-criteria").getAttribute("data-definition-id")}return e.prototype.main=function(){this.setupEvents(this.criteria)},e.prototype.setupEvents=function(e){e.forEach(function(e){const t=this;var n=document.getElementById("advancedgrading-frubric-criteria-"+e.criteriaid).children[0].children;document.getElementById(`advancedgrading-frubric-criteria-${e.criteriaid}-level-grade`).addEventListener("focus",t.focusEvaluationHandler.bind(this,t)),Array.from(n).forEach(function(e){e=e.children[1].children;Array.from(e).forEach(function(e){e instanceof HTMLInputElement&&"checkbox"===e.type&&e.addEventListener("click",t.clickDescriptorHandler.bind(t))})},t)},this)},e.prototype.clickDescriptorHandler=function(e){var e=e.target.id.split("-"),t=e[3],n=e[5];const i=e[e.length-1];e=JSON.parse(d.getLevelsJSON(t));e[n].definition.replace(/\\/g,"");let r=JSON.parse(e[n].definition);var a,o=e[n].descriptors;let c=[];o.forEach(e=>{c.push(e.descriptorid)},c),-1==c.indexOf(parseInt(i))&&(a={checked:!1,descText:document.getElementById(`advancedgrading-frubric-criteria-${t}-level-${n}-descriptor-`+i).nextSibling.textContent,delete:0,descriptorid:i},o.push(a)),o.filter(e=>{e.descriptorid==i&&(e.checked=!e.checked)},i),r.descriptors=o,r=JSON.stringify(r),e[n].definition=r,document.getElementById(`advancedgrading-frubric-${t}-leveljson`).value=JSON.stringify(e),document.getElementById(`advancedgrading-frubric-${t}-leveljsonaux`).value=JSON.stringify(e)},e.prototype.focusEvaluationHandler=function(e,t){document.getElementById(t.target.id).addEventListener("change",e.onChangeEvaluationHandler.bind(this,e)),document.getElementById(t.target.id).addEventListener("change",e.sumTotal.bind(this,e))},e.prototype.onChangeEvaluationHandler=function(e,t){t.target.classList.remove("total-input-error");var n=parseFloat(document.getElementById(t.target.id).value),i=(console.log("onChangeEvaluationHandler"),console.log(n),document.getElementById(t.target.id+"-out-of-value").innerText.split("/")),i=parseFloat(i[i.length-1]);console.log("maxscore"),console.log(i),i<n||n<0?t.target.classList.add("total-input-error"):(document.getElementById(t.target.id).value=n,document.getElementById(t.target.id).innerHTML=n)},e.prototype.sumTotal=function(e,t){var n=document.getElementById("advancedgrading-criteria").querySelectorAll(".total-input"),i=0,r=!1,a=-1;n.forEach((e,t)=>{e.classList.contains("result")||e.classList.contains("total-input-error")||(i+=parseFloat(e.value)),e.classList.contains("result")&&(a=t),e.classList.contains("total-input-error")&&(r=!0),-1<a&&(t=parseFloat(n[a].getAttribute("max")),!r)&&i<=t&&(n[a].value=i)})},{init:function(){(new e).main()}}});