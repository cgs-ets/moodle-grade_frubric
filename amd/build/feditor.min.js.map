{"version":3,"sources":["../src/feditor.js"],"names":["define","$","Log","Templates","Ajax","Str","FeditorHelper","Feditor","criterioncollection","debug","self","CRITERION_ROW","prototype","main","setupEvents","document","getElementById","addEventListener","addCriterion","bind","countcriteria","querySelectorAll","length","context","id","criteriongroupid","description","new","render","done","html","js","appendNodeContents","cr","querySelector","lastElementChild","criterion","getAttribute","cid","status","rowindex","rowIndex","definitionid","levels","getCriteriaJSON","JSON","parse","value","push","stringify","fail","ex","init","mode","getMode","control"],"mappings":"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","sourcesContent":["/* eslint-disable max-len */\n/* eslint-disable promise/always-return */\n// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n\n/**\n * @package   gradingform_frubric\n * @copyright 2021 Veronica Bermegui\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/log', 'core/templates', 'core/ajax', 'core/str', 'gradingform_frubric/feditor_helper'],\n    function ($, Log, Templates, Ajax, Str, FeditorHelper) {\n        'use strict';\n\n        function init() {\n            const mode = FeditorHelper.getMode();\n            let criterioncollection;\n\n            if (mode === 'edit') {\n                criterioncollection = document.getElementById('id_criteria').value;\n            } else {\n                // Initialise the first criterion\n                var criterion = {\n                  id: 1,\n                  cid: `frubric-criteria-NEWID${\n                    document.querySelectorAll(\".criterion-header\").length\n                  }`, // Criterion ID for the DB\n                  status: \"NEW\",\n                  description: \"\", // Criterion descrption\n                  rowindex: 1, // Keep track of the header row.\n                  definitionid: document\n                    .getElementById(\"cont\")\n                    .getAttribute(\"data-definition-id\"), // Id from mdl_grading_definitions/\n                  levels: [],\n                };\n\n                criterioncollection = [criterion]; // Collects all the criterions\n                document.getElementById('id_criteria').value = JSON.stringify(criterioncollection);\n            }\n\n            let control = new Feditor(criterioncollection);\n            control.main();\n        }\n\n       /**\n        *\n        * @param {*} criterioncollection\n        */\n        function Feditor(criterioncollection) {\n            Log.debug('Feditor: initialising...');\n            let self = this;\n            self.CRITERION_ROW = 'gradingform_frubric/editor_criterion_row';\n            self.criterioncollection = criterioncollection;\n        }\n\n        /**\n         * Run the controller.\n         *\n         */\n        Feditor.prototype.main = function () {\n            let self = this;\n            Log.debug(this);\n            self.setupEvents();\n\n        };\n\n        Feditor.prototype.setupEvents = function () {\n            let self = this;\n            // Add criterio btn\n            document.getElementById('addCriterion').addEventListener('click', self.addCriterion.bind(this));\n        };\n\n        Feditor.prototype.addCriterion = function () {\n            let self = this;\n\n            const countcriteria = document.querySelectorAll('.criterion-header').length;\n            // Set context\n            const context = {\n                id: `frubric-criteria-NEWID${countcriteria + 1}`,\n                criteriongroupid: countcriteria + 1,\n                description: 'Click to edit criterion',\n                new: 1, // Adds the result row\n            };\n\n\n            Templates.render(self.CRITERION_ROW, context)\n                .done(function (html, js) {\n\n                    Templates.appendNodeContents(document.getElementById('criteriaTable'), html, js);\n                    const cr = document.querySelector(\"tbody\").lastElementChild;\n\n                    let criterion = {\n                        id: cr.getAttribute('data-criterion-group'),\n                        cid: `frubric-criteria-NEWID${countcriteria + 1}`, // Criterion ID for the DB\n                        status: 'NEW',\n                        new: 1, // to add the result row\n                        description: '', // Criterion descrption\n                        rowindex: cr.rowIndex, // Keep track of the header row.\n                        definitionid: document.getElementById('cont').getAttribute('data-definition-id'), // Id from mdl_grading_definitions\n                        levels: [],\n                    };\n\n                    if (FeditorHelper.getCriteriaJSON() != '') {\n                        self.criterioncollection = JSON.parse(document.getElementById('id_criteria').value);\n                    }\n\n                    self.criterioncollection.push(criterion);\n                    document.getElementById('id_criteria').value = JSON.stringify(self.criterioncollection);\n\n                })\n                .fail(function (ex) {\n                    Log.debug(\"error...\");\n                    Log.debug(ex);\n                });\n\n        };\n\n\n        return {\n            init: init\n        };\n    });"],"file":"feditor.min.js"}