{"version":3,"sources":["../src/feditor.js"],"names":["define","Log","Templates","FeditorHelper","Feditor","criterioncollection","self","CRITERION_ROW","FEDITOR","prototype","main","setupEvents","document","getElementById","addEventListener","addCriterion","bind","countcriteria","querySelectorAll","length","context","id","criteriongroupid","new","render","done","html","js","appendNodeContents","cr","querySelector","lastElementChild","criterion","getAttribute","cid","status","description","rowindex","rowIndex","definitionid","levels","sumscore","getCriteriaJSON","JSON","parse","value","push","setCriteriaJSON","setHiddenCriteriaJSON","fail","ex","debug","init","mode","getMode","empty","totaloutof","classList","contains","control"],"mappings":"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","sourcesContent":["/* eslint-disable max-len */\n/* eslint-disable promise/always-return */\n// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n\n/**\n * @package   gradingform_frubric\n * @copyright 2021 Veronica Bermegui\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['core/log', 'core/templates', 'gradingform_frubric/feditor_helper'],\n    function (Log, Templates, FeditorHelper) {\n        'use strict';\n\n        function init() {\n            const mode = FeditorHelper.getMode();\n            let criterioncollection;\n         \n            // In case the all the rubric is deleted and saved in the DB. We need to put an empty one again.\n            //Otherwise the add button submits the form.\n            const empty = JSON.parse(document.getElementById('id_criteria').value).length == 0;\n            \n            if (mode === 'create' && empty) {\n                // Initialise the first criterion\n                var criterion = {\n                    id: '1',\n                    cid: `frubric-criteria-NEWID${document.querySelectorAll(\".criterion-header\").length}`, // Criterion ID for the DB\n                    status: \"NEW\",\n                    description: \"\", // Criterion descrption\n                    rowindex: 1, // Keep track of the header row.\n                    definitionid: document\n                        .getElementById(\"cont\")\n                        .getAttribute(\"data-definition-id\"), // Id from mdl_grading_definitions/\n                    levels: [],\n                    sumscore: \"\",\n                    totaloutof: \"\"\n                };\n\n                criterioncollection = [criterion]; // Collects all the criterions\n\n                FeditorHelper.setCriteriaJSON(criterioncollection);\n                FeditorHelper.setHiddenCriteriaJSON(criterioncollection);\n\n            }\n            if (mode === 'edit' || (mode === 'create' && document.getElementById('id_criteria').classList.contains('is-invalid') != undefined)) { // Validation error, keep the values inserted\n                criterioncollection = document.getElementById('id_criteria').value;\n\n            } else {\n                // Initialise the first criterion\n                var criterion = {\n                    id: \"1\",\n                    cid: `frubric-criteria-NEWID${document.querySelectorAll(\".criterion-header\").length}`, // Criterion ID for the DB\n                    status: \"NEW\",\n                    description: \"\", // Criterion descrption\n                    rowindex: 1, // Keep track of the header row.\n                    definitionid: document\n                        .getElementById(\"cont\")\n                        .getAttribute(\"data-definition-id\"), // Id from mdl_grading_definitions/\n                    levels: [],\n                    sumscore: \"\",\n                    totaloutof: \"\",\n                };\n\n                criterioncollection = [criterion]; // Collects all the criterions\n               \n                FeditorHelper.setCriteriaJSON(criterioncollection);\n                FeditorHelper.setHiddenCriteriaJSON(criterioncollection);\n\n            }\n\n            let control = new Feditor(criterioncollection);\n            control.main();\n\n        }\n\n        /**\n         *\n         * @param {*} criterioncollection\n         */\n        function Feditor(criterioncollection) {\n            let self = this;\n            self.CRITERION_ROW = 'gradingform_frubric/editor_criterion_row';\n            self.FEDITOR = 'gradingform_frubric/frubriceditor';\n            self.criterioncollection = criterioncollection;\n        }\n\n        /**\n         * Run the controller.\n         *\n         */\n        Feditor.prototype.main = function () {\n            let self = this;\n            self.setupEvents();\n\n        };\n\n        Feditor.prototype.setupEvents = function () {\n            let self = this;\n            // Add criterio btn\n            document.getElementById('addCriterion').addEventListener('click', self.addCriterion.bind(this));\n        };\n\n        Feditor.prototype.addCriterion = function () {\n            let self = this;\n\n            const countcriteria = document.querySelectorAll('.criterion-header').length;\n            // Set context\n            const context = {\n                id: `frubric-criteria-NEWID${countcriteria + 1}`,\n                criteriongroupid: countcriteria + 1,\n                new: 1, // Adds the result row\n            };\n\n\n            Templates.render(self.CRITERION_ROW, context)\n                .done(function (html, js) {\n\n                    Templates.appendNodeContents(document.getElementById('criteriaTable'), html, js);\n                    const cr = document.querySelector(\"tbody\").lastElementChild;\n\n                    let criterion = {\n                        id: cr.getAttribute('data-criterion-group'),\n                        cid: `frubric-criteria-NEWID${countcriteria + 1}`, // Criterion ID for the DB\n                        status: 'NEW',\n                        new: 1, // to add the result row\n                        description: '', // Criterion descrption\n                        rowindex: cr.rowIndex, // Keep track of the header row.\n                        definitionid: document.getElementById('cont').getAttribute('data-definition-id'), // Id from mdl_grading_definitions\n                        levels: [],\n                        sumscore: \"\",\n                    };\n\n\n                    if (FeditorHelper.getCriteriaJSON() != '') {\n                        self.criterioncollection = JSON.parse(document.getElementById('id_criteria').value);\n                    }\n\n                    self.criterioncollection.push(criterion);\n                    FeditorHelper.setCriteriaJSON(self.criterioncollection);\n                    FeditorHelper.setHiddenCriteriaJSON(self.criterioncollection);\n\n                })\n                .fail(function (ex) {\n                    Log.debug(ex);\n                });\n\n\n        };\n\n        return {\n            init: init\n        };\n    });"],"file":"feditor.min.js"}