{"version":3,"sources":["../src/submission_control.js"],"names":["define","$","Log","SubmissionControl","submiteddata","definitionID","self","document","getElementById","getAttribute","prototype","main","checkCriteria","checkScore","criteria","debug","Object","entries","forEach","key","value","scoregiven","classList","remove","maxallowed","innerText","split","length","parseFloat","add","totaldescriptor","totalnotchecked","values","JSON","parse","leveljson","val","Y","log","descriptors","d","checked","enteredscore","maxscore","init","control"],"mappings":"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","sourcesContent":["/* eslint-disable max-len */\n/* eslint-disable promise/always-return */\n// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n\n/**\n * @package   gradingform_frubric\n * @copyright 2021 Veronica Bermegui\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/log', 'core/templates', 'core/ajax', 'core/str', 'gradingform_frubric/feditor_helper'],\n    function ($, Log, Templates, Ajax, Str, FeditorHelper) {\n        'use strict';\n\n        function init(submiteddata, definitionID) {\n\n            Log.debug(\"gradingform_frubric: Submission Control...\");\n            submiteddata = JSON.parse(submiteddata);\n            const control = new SubmissionControl(submiteddata, definitionID);\n            control.main(submiteddata, definitionID);\n        }\n\n        function SubmissionControl(submiteddata, definitionID) {\n            const self = this;\n            self.definitionID = definitionID;\n            self.submiteddata = submiteddata;\n            self.definitionID = document.getElementById('advancedgrading-criteria').getAttribute('data-definition-id');\n\n\n        }\n\n        SubmissionControl.prototype.main = function () {\n            const self = this;\n            self.checkCriteria(self.submiteddata);\n            self.checkScore(self.criteria);\n\n\n        }\n\n        SubmissionControl.prototype.checkCriteria = function () {\n            Log.debug('checkCriteria...')\n            var self = this;\n            Object.entries(self.submiteddata.criteria).forEach(([key, value]) => {\n\n                // Check score given to the criterion\n                const scoregiven = document.getElementById(`advancedgrading-frubric-criteria-${key}-level-grade`);\n                scoregiven.classList.remove('total-input-error');\n                let maxallowed = document.getElementById(`advancedgrading-frubric-criteria-${key}-level-grade-out-of-value`).innerText.split('/');\n                maxallowed = maxallowed[maxallowed.length - 1];\n\n                if (parseFloat(scoregiven.value) > parseFloat(maxallowed)) {\n                    scoregiven.classList.add('total-input-error');\n                }\n\n                // Check that at least one  descriptor is selected\n                var totaldescriptor = 0;\n                var totalnotchecked = 0;\n                \n                Object.values(JSON.parse(value.leveljson)).forEach(val => {\n                    Y.log(val.descriptors);\n                    totaldescriptor += val.descriptors.length;\n                    \n                    val.descriptors.forEach(d => {\n                        ;\n                        Y.log(d);\n                        if (d.checked == false) {\n                            totalnotchecked++;\n                        }\n                    });\n\n                  \n                });\n\n                if (totaldescriptor == totalnotchecked) {\n                    document.getElementById(`advancedgrading-frubric-criteria-${key}`).classList.add('error_no_descriptors_selected'); \n                }\n            });\n\n        }\n\n        SubmissionControl.prototype.checkScore = function () {\n            var self = this;\n            let scoregiven = document.getElementById(`advancedgrading-${self.definitionID}-frubric-total-grade`);\n            scoregiven.classList.remove('total-input-error');\n            let enteredscore = parseFloat(scoregiven.value);\n            let maxscore = document.getElementById(`advancedgrading-${self.definitionID}-frubric-total-grade-given`).innerText.split('/');\n            maxscore = parseFloat(maxscore[maxscore.length - 1]);\n\n            if (enteredscore > maxscore || enteredscore < 0) {\n                scoregiven.classList.add('total-input-error');\n            }\n\n        }\n\n        return {\n            init: init\n        };\n    });"],"file":"submission_control.min.js"}