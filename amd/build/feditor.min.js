define ("gradingform_frubric/feditor",["core/log","core/templates","gradingform_frubric/feditor_helper"],function(a,b,c){'use strict';function d(b){a.debug("Feditor: initialising...");var c=this;c.CRITERION_ROW="gradingform_frubric/editor_criterion_row";c.FEDITOR="gradingform_frubric/frubriceditor";c.criterioncollection=b}d.prototype.main=function(){var a=this;a.setupEvents()};d.prototype.setupEvents=function(){var a=this;document.getElementById("addCriterion").addEventListener("click",a.addCriterion.bind(this))};d.prototype.addCriterion=function(){a.debug("Add criterion...");var d=this,e=document.querySelectorAll(".criterion-header").length,f={id:"frubric-criteria-NEWID".concat(e+1),criteriongroupid:e+1,new:1};b.render(d.CRITERION_ROW,f).done(function(a,f){b.appendNodeContents(document.getElementById("criteriaTable"),a,f);var g=document.querySelector("tbody").lastElementChild,h={id:g.getAttribute("data-criterion-group"),cid:"frubric-criteria-NEWID".concat(e+1),status:"NEW",new:1,description:"",rowindex:g.rowIndex,definitionid:document.getElementById("cont").getAttribute("data-definition-id"),levels:[],sumscore:""};if(""!=c.getCriteriaJSON()){d.criterioncollection=JSON.parse(document.getElementById("id_criteria").value)}d.criterioncollection.push(h);c.setCriteriaJSON(d.criterioncollection);c.setHiddenCriteriaJSON(d.criterioncollection)}).fail(function(b){a.debug("error...");a.debug(b)});var g="20"==document.getElementById("id_status").value;if(g){document.querySelector(".gradingform_rubric-regrade").setAttribute("hidden",!0)}};return{init:function(){a.debug("Feditor control...");var b=c.getMode(),e,f=0==JSON.parse(document.getElementById("id_criteria").value).length;if("create"===b&&f){var g={id:"1",cid:"frubric-criteria-NEWID".concat(document.querySelectorAll(".criterion-header").length),status:"NEW",description:"",rowindex:1,definitionid:document.getElementById("cont").getAttribute("data-definition-id"),levels:[],sumscore:"",totaloutof:""};e=[g];c.setCriteriaJSON(e);c.setHiddenCriteriaJSON(e)}if("edit"===b||"create"===b&&document.getElementById("id_criteria").classList.contains("is-invalid")!=void 0){e=document.getElementById("id_criteria").value}else{var g={id:"1",cid:"frubric-criteria-NEWID".concat(document.querySelectorAll(".criterion-header").length),status:"NEW",description:"",rowindex:1,definitionid:document.getElementById("cont").getAttribute("data-definition-id"),levels:[],sumscore:"",totaloutof:""};e=[g];c.setCriteriaJSON(e);c.setHiddenCriteriaJSON(e)}var h=new d(e);h.main()}}});
//# sourceMappingURL=feditor.min.js.map
