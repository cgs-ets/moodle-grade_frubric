define ("gradingform_frubric/feditor",["jquery","core/log","core/templates","gradingform_frubric/feditor_helper","gradingform_frubric/rerender_control"],function(a,b,c,d,e){'use strict';function f(a){b.debug("Feditor: initialising...");var c=this;c.CRITERION_ROW="gradingform_frubric/editor_criterion_row";c.FEDITOR="gradingform_frubric/frubriceditor";c.criterioncollection=a}f.prototype.main=function(){var a=this;a.setupEvents()};f.prototype.setupEvents=function(){var a=this;document.getElementById("addCriterion").addEventListener("click",a.addCriterion.bind(this))};f.prototype.addCriterion=function(){b.debug("Add criterion...");var a=this,e=document.querySelectorAll(".criterion-header").length,f={id:"frubric-criteria-NEWID".concat(e+1),criteriongroupid:e+1,new:1};c.render(a.CRITERION_ROW,f).done(function(b,f){c.appendNodeContents(document.getElementById("criteriaTable"),b,f);var g=document.querySelector("tbody").lastElementChild,h={id:g.getAttribute("data-criterion-group"),cid:"frubric-criteria-NEWID".concat(e+1),status:"NEW",new:1,description:"",rowindex:g.rowIndex,definitionid:document.getElementById("cont").getAttribute("data-definition-id"),levels:[],sumscore:""};if(""!=d.getCriteriaJSON()){a.criterioncollection=JSON.parse(document.getElementById("id_criteria").value)}a.criterioncollection.push(h);d.setCriteriaJSON(a.criterioncollection)}).fail(function(a){b.debug("error...");b.debug(a)});var g="20"==document.getElementById("id_status").value;if(g){document.querySelector(".gradingform_rubric-regrade").setAttribute("hidden",!0)}};return{init:function(){b.debug("Feditor control...");var a=d.getMode(),c;if("create"===a&&document.getElementById("id_criteria").classList.contains("is-invalid")){e.init("rerendercreate")}if("edit"===a||"create"===a&&document.getElementById("id_criteria").classList.contains("is-invalid")!=void 0){c=document.getElementById("id_criteria").value}else{var g={id:1,cid:"frubric-criteria-NEWID".concat(document.querySelectorAll(".criterion-header").length),status:"NEW",description:"",rowindex:1,definitionid:document.getElementById("cont").getAttribute("data-definition-id"),levels:[],sumscore:"",totaloutof:""};c=[g];document.getElementById("id_criteria").value=JSON.stringify(c)}if(0==document.getElementById("cont").getAttribute("data-rerendered")){if("edit"==a&&!0==document.getElementById("id_criteria").classList.contains("is-invalid")){e.init("rerenderupdate")}}var h=new f(c);h.main()}}});
//# sourceMappingURL=feditor.min.js.map
