define(["core/log","core/templates","gradingform_frubric/feditor_helper"],function(t,n,o){"use strict";function d(e){var t=this;t.CRITERION_ROW="gradingform_frubric/editor_criterion_row",t.FEDITOR="gradingform_frubric/frubriceditor",t.criterioncollection=e}return d.prototype.main=function(){this.setupEvents()},d.prototype.setupEvents=function(){document.getElementById("addCriterion").addEventListener("click",this.addCriterion.bind(this))},d.prototype.addCriterion=function(){let i=this;const r=document.querySelectorAll(".criterion-header").length;var e={id:"frubric-criteria-NEWID"+(r+1),criteriongroupid:r+1,new:1};n.render(i.CRITERION_ROW,e).done(function(e,t){n.appendNodeContents(document.getElementById("criteriaTable"),e,t);e=document.querySelector("tbody").lastElementChild,t={id:e.getAttribute("data-criterion-group"),cid:"frubric-criteria-NEWID"+(r+1),status:"NEW",new:1,description:"",rowindex:e.rowIndex,definitionid:document.getElementById("cont").getAttribute("data-definition-id"),levels:[],sumscore:""};""!=o.getCriteriaJSON()&&(i.criterioncollection=JSON.parse(document.getElementById("id_criteria").value)),i.criterioncollection.push(t),o.setCriteriaJSON(i.criterioncollection),o.setHiddenCriteriaJSON(i.criterioncollection)}).fail(function(e){t.debug(e)})},{init:function(){var e=o.getMode();let t;var i,r=0==JSON.parse(document.getElementById("id_criteria").value).length;"create"===e&&r&&(i={id:"1",cid:"frubric-criteria-NEWID"+document.querySelectorAll(".criterion-header").length,status:"NEW",description:"",rowindex:1,definitionid:document.getElementById("cont").getAttribute("data-definition-id"),levels:[],sumscore:"",totaloutof:""},t=[i],o.setCriteriaJSON(t),o.setHiddenCriteriaJSON(t)),"edit"===e||"create"===e&&null!=document.getElementById("id_criteria").classList.contains("is-invalid")?t=document.getElementById("id_criteria").value:(i={id:"1",cid:"frubric-criteria-NEWID"+document.querySelectorAll(".criterion-header").length,status:"NEW",description:"",rowindex:1,definitionid:document.getElementById("cont").getAttribute("data-definition-id"),levels:[],sumscore:"",totaloutof:""},t=[i],o.setCriteriaJSON(t),o.setHiddenCriteriaJSON(t)),new d(t).main()}}});