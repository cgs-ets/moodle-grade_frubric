/**
 * @package   gradingform_frubric
 * @copyright 2021 Veronica Bermegui
 * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("gradingform_frubric/feditor",["core/log","core/templates","gradingform_frubric/feditor_helper"],(function(Log,Templates,FeditorHelper){function Feditor(criterioncollection){this.CRITERION_ROW="gradingform_frubric/editor_criterion_row",this.FEDITOR="gradingform_frubric/frubriceditor",this.criterioncollection=criterioncollection}return Feditor.prototype.main=function(){this.setupEvents()},Feditor.prototype.setupEvents=function(){document.getElementById("addCriterion").addEventListener("click",this.addCriterion.bind(this))},Feditor.prototype.addCriterion=function(){var self=this,countcriteria=document.querySelectorAll(".criterion-header").length,context={id:"frubric-criteria-NEWID".concat(countcriteria+1),criteriongroupid:countcriteria+1,new:1};Templates.render(self.CRITERION_ROW,context).done((function(html,js){Templates.appendNodeContents(document.getElementById("criteriaTable"),html,js);var cr=document.querySelector("tbody").lastElementChild,criterion={id:cr.getAttribute("data-criterion-group"),cid:"frubric-criteria-NEWID".concat(countcriteria+1),status:"NEW",new:1,description:"",rowindex:cr.rowIndex,definitionid:document.getElementById("cont").getAttribute("data-definition-id"),levels:[],sumscore:""};""!=FeditorHelper.getCriteriaJSON()&&(self.criterioncollection=JSON.parse(document.getElementById("id_criteria").value)),self.criterioncollection.push(criterion),FeditorHelper.setCriteriaJSON(self.criterioncollection),FeditorHelper.setHiddenCriteriaJSON(self.criterioncollection)})).fail((function(ex){Log.debug(ex)}))},{init:function(){var criterioncollection,mode=FeditorHelper.getMode(),empty=0==JSON.parse(document.getElementById("id_criteria").value).length;"create"===mode&&empty&&(criterioncollection=[{id:"1",cid:"frubric-criteria-NEWID".concat(document.querySelectorAll(".criterion-header").length),status:"NEW",description:"",rowindex:1,definitionid:document.getElementById("cont").getAttribute("data-definition-id"),levels:[],sumscore:"",totaloutof:""}],FeditorHelper.setCriteriaJSON(criterioncollection),FeditorHelper.setHiddenCriteriaJSON(criterioncollection)),"edit"===mode||"create"===mode&&null!=document.getElementById("id_criteria").classList.contains("is-invalid")?criterioncollection=document.getElementById("id_criteria").value:(criterioncollection=[{id:"1",cid:"frubric-criteria-NEWID".concat(document.querySelectorAll(".criterion-header").length),status:"NEW",description:"",rowindex:1,definitionid:document.getElementById("cont").getAttribute("data-definition-id"),levels:[],sumscore:"",totaloutof:""}],FeditorHelper.setCriteriaJSON(criterioncollection),FeditorHelper.setHiddenCriteriaJSON(criterioncollection)),new Feditor(criterioncollection).main()}}}));

//# sourceMappingURL=feditor.min.js.map