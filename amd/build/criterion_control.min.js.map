{"version":3,"sources":["../src/criterion_control.js"],"names":["define","Log","Templates","Str","Notification","LevelControl","FeditorHelper","CriterionControl","mode","id","self","LEVEL_ROW","prototype","main","currentRow","document","getElementById","setupEvents","getAttribute","init","error","debug","actions","querySelector","addLevelRow","getNextElement","Y","log","children","actionChildren","addEventListener","removeCriterion","bind","addLevel","description","editCriterionDescription","focusoutHandlerDisabled","resultRow","criterionTitletd","criterionTotaltd","validateTotal","row","randomid","getRandomID","context","render","done","html","prevlevel","classname","nextCriterion","prevresultlevel","getPreviousElement","resultrow","classList","contains","remove","insertAdjacentHTML","criterioncollection","getCriteriaJSON","filterCriterion","getCriterionFromCriteriaCollection","levels","push","score","status","descriptors","setCriteriaJSON","setHiddenCriteriaJSON","fail","ex","get_strings","key","component","strs","confirm","criTable","criterionToDelete","target","parentNode","rowIndex","criteariaID","frc","JSON","parse","value","frctodel","filter","criterion","index","rowindex","j","length","i","rows","add","className","elements","getElementsByClassName","removeChild","deleteRow","e","stopPropagation","textarea","removeAttribute","focus","changeCriterionHandlerDisabled","setAttribute","getMode","cid","includes","inputvalue","valueAsNumber","min","max","NaN","criteria","sumscore","control"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n\n/**\n * @package   gradingform_frubric\n * @copyright 2021 Veronica Bermegui\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['core/log', 'core/templates',  'core/str', 'core/notification', 'gradingform_frubric/level_control', 'gradingform_frubric/feditor_helper'],\n    function (Log, Templates, Str, Notification, LevelControl, FeditorHelper) {\n        'use strict';\n\n        function init(id) {\n            Log.debug('Criterion control...');\n            const mode = FeditorHelper.getMode();\n            let control = new CriterionControl(mode, id);\n            control.main();\n        }\n\n        /**\n         *\n         * @param {*} mode\n         */\n        function CriterionControl(mode, id) {\n            const self = this;\n            self.LEVEL_ROW = 'gradingform_frubric/editor_level_row';\n            self.mode = mode;\n            self.id = id;\n        }\n\n        /**\n         * Run the controller.\n         *\n         */\n        CriterionControl.prototype.main = function () {\n            let self = this;\n            const currentRow = document.getElementById(self.id);\n\n            if (self.mode == 'edit') { // Add the listeners to all the criterion rows.\n                try {\n                    self.setupEvents(currentRow);\n                    // Attach level listeners.\n                    currentRow.getAttribute('data-criterion-group');\n                    LevelControl.init(self.id);\n\n                } catch (error) {\n                    Log.debug(error);\n                }\n\n            } else {\n                self.setupEvents(currentRow);\n            }\n\n        };\n\n        CriterionControl.prototype.setupEvents = function (currentRow) {\n            let self = this;\n            const actions = currentRow.querySelector('.act'); // Get actions cell data-row-type=\"criterion-add-level\"\n            const addLevelRow = FeditorHelper.getNextElement(currentRow, '.add-level-r');\n            Y.log(\"addLevelRow\");\n            Y.log(addLevelRow.children);\n            if (!actions) {\n                return;\n            }\n\n            const actionChildren = actions.children;\n\n            // Criterion actions.\n            actionChildren[0].addEventListener('click', self.removeCriterion.bind(currentRow));\n         //   actionChildren[1].addEventListener('click', self.addLevel.bind(self, currentRow));\n           addLevelRow.children[0].addEventListener('click', self.addLevel.bind(self, currentRow));\n\n            const description = currentRow.querySelector('.crit-desc'); // Get description\n            description.addEventListener('click', self.editCriterionDescription.bind(this));\n            description.addEventListener('focusout', self.focusoutHandlerDisabled);\n\n            // Get the previous criterion to attach events to the total criterion row at the top of this one.\n            const resultRow = FeditorHelper.getNextElement(currentRow, '.result-r');\n\n            if (resultRow != undefined) {\n                const [criterionTitletd, criterionTotaltd] = resultRow.children;\n                criterionTotaltd.querySelector('.total-input').addEventListener('blur', self.validateTotal);\n            }\n\n\n        };\n\n        CriterionControl.prototype.addLevel = function (row) {\n            let self = this;\n            const randomid = FeditorHelper.getRandomID();\n            const context = {\n                'score': 'Click to edit Mark',\n                'definition': 'Click to edit Level description',\n                'criteriongroupid': row.getAttribute('data-criterion-group'),\n                'id': randomid,\n            };\n         \n\n          \n            Templates.render(self.LEVEL_ROW, context)\n                .done(function (html, js) {\n\n                    var prevlevel;\n                    const classname = `.level-${row.getAttribute('data-criterion-group')}`;\n                    let nextCriterion = FeditorHelper.getNextElement(row, '.criterion-header');\n\n                    if (nextCriterion != undefined) { //  If there is another criterion the level is on top of this row\n\n                        const prevresultlevel = FeditorHelper.getPreviousElement(nextCriterion, '.result-r'); // The new level is on top of the result row for this criterion.\n                        prevlevel = FeditorHelper.getPreviousElement(prevresultlevel, classname);\n\n                        if (prevlevel == undefined) { // If undefined, the criterion represented by row has no levels. Add the level under the current criterion\n                            prevlevel = row;\n                        }\n\n                    } else {\n\n                        const resultrow = FeditorHelper.getNextElement(row, '.result-r'); // Get the result row for this criterion\n\n                        prevlevel = FeditorHelper.getPreviousElement(resultrow, classname);\n                        \n                       \n                        if (prevlevel == undefined) { // This criterion doesnt have levels yet.\n                            prevlevel = row;\n                        }\n\n                          //Check if the row has a red border around when it failed validation\n                        if (prevlevel.classList.contains('is-invalid')) {\n                            prevlevel.classList.remove('is-invalid');\n                            prevlevel.classList.remove('form-control');\n                        }\n                    }\n\n                    prevlevel.insertAdjacentHTML('beforebegin', html); \n\n                    const levelObject = {\n                        score: 0,\n                        status: 'NEW',\n                        id: randomid,\n                        descriptors: []\n                    }\n                    const criterioncollection = FeditorHelper.getCriteriaJSON();\n                    const filterCriterion = FeditorHelper.getCriterionFromCriteriaCollection(row, criterioncollection);\n\n                    filterCriterion[0].levels.push(levelObject);\n                    // Refresh the JSON input\n                    FeditorHelper.setCriteriaJSON(criterioncollection);\n                    FeditorHelper.setHiddenCriteriaJSON(criterioncollection);\n\n                    LevelControl.init(randomid, self.id);\n                })\n                .fail(function (ex) {\n                    Log.debug(\"error...\");\n                    Log.debug(ex);\n                });\n\n\n        };\n\n\n        CriterionControl.prototype.removeCriterion = function (row) {\n\n            Str.get_strings([{\n                    key: 'confirm',\n                    component: 'gradingform_frubric'\n                },\n                {\n                    key: 'confirmdeletecriterion',\n                    component: 'gradingform_frubric'\n                },\n                {\n                    key: 'yes'\n                },\n                {\n                    key: 'no'\n                },\n\n            ]).done(function (strs) {\n                Notification.confirm(strs[0], strs[1], strs[2], strs[3], function () {\n                    let criTable = document.getElementById('criteriaTable');\n                    let criterionToDelete = row.target.parentNode.parentNode.parentNode.parentNode.rowIndex;\n\n                    const criteariaID = row.target.parentNode.parentNode.parentNode.parentNode.getAttribute('data-criterion-group');\n\n                    // Change the criterion status tu DELETE, to be able to delete from the DB.\n                    let frc = JSON.parse(document.getElementById('id_criteria').value);\n\n                    // Change the description in the JSON\n                    const frctodel = frc.filter(function (criterion, index) {\n                        const criteariaID = this.getAttribute('data-criterion-group');\n                        criterion.rowindex = index;\n                        if (criteariaID == criterion.id) {\n                            return criterion;\n                        }\n                    }, row.target.parentNode.parentNode.parentNode.parentNode);\n\n                \n                    frctodel[0].status = \"DELETE\";\n                    const levels = frctodel[0].levels;\n               \n                    // Change the status for the levels in this criterion\n\n                    for (let j = 0; j < levels.length; j++) {\n                        levels[j].status = \"DELETE\";\n                    }\n                 \n                    FeditorHelper.setCriteriaJSON(frc);\n                    FeditorHelper.setHiddenCriteriaJSON(frc);\n                  \n                    // Delete all the levels in that criterion.\n                    for (let i = (criterionToDelete + 1); i < criTable.rows.length; i++) {\n                        if (criTable.rows[i].getAttribute('data-criterion-group') == criteariaID) {\n                            criTable.rows[i].classList.add('to-remove'); // Tag the rows to delete.\n                        } else {\n                            break;\n                        }\n                    }\n\n                    removeElementsByClass('to-remove');\n\n                    function removeElementsByClass(className) {\n                        var elements = document.getElementsByClassName(className);\n                        while (elements.length > 0) {\n                            elements[0].parentNode.removeChild(elements[0]);\n                        }\n                    }\n                    criTable.deleteRow(criterionToDelete);\n                 \n\n                }, function () {\n                    return;\n                });\n            });\n        };\n\n   \n        CriterionControl.prototype.editCriterionDescription = function (e) {\n            e.stopPropagation();\n            Log.debug('edit criterion description');\n            let textarea = e.target;\n           \n            textarea.removeAttribute('disabled');\n            textarea.focus();\n\n            textarea.addEventListener('change', this.changeCriterionHandlerDisabled.bind(this));\n        };\n\n\n        CriterionControl.prototype.focusoutHandlerDisabled = function (e) {\n            e.target.setAttribute('disabled', true);\n        };\n\n        CriterionControl.prototype.changeCriterionHandlerDisabled = function (e) {\n\n            const criterioncollection = (document.getElementById('id_criteria').value) ? JSON.parse(document.getElementById('id_criteria').value) : [];\n\n            // Change the description in the JSON.\n            const filterCriterion = criterioncollection.filter(function (criterion, index) {\n                const id = e.target.parentNode.parentNode.getAttribute('data-criterion-group');\n                criterion.rowindex = index;\n                if (id == criterion.id) {\n                    return criterion;\n                }\n            }, e);\n\n            if (filterCriterion[0].description != e.target.value && (FeditorHelper.getMode() == 'edit' &&\n                    !filterCriterion[0].cid.includes('frubric-criteria-NEWID'))) { // A new criterion is added to an existing definition\n                filterCriterion[0].status = 'UPDATE';\n            }\n\n            filterCriterion[0].description = e.target.value;\n            // Refresh the Criteria JSON input\n            //document.getElementById('id_criteria').value = JSON.stringify(criterioncollection);\n            FeditorHelper.setCriteriaJSON(criterioncollection);\n            FeditorHelper.setHiddenCriteriaJSON(criterioncollection);\n            \n            // Check if the criterion has a red border because it comes from a failed attempt to save and make ready.\n\n            if (e.target.classList.contains('is-invalid')) {\n                e.target.classList.remove('is-invalid');\n                e.target.classList.remove('form-control');\n            }\n        };\n\n        CriterionControl.prototype.getCriteriaJSON = function () {\n            return (document.getElementById('id_criteria').value) ? JSON.parse(document.getElementById('id_criteria').value) : [];\n        }; // TODO:DElete and use the one in the helper.\n        CriterionControl.prototype.validateTotal = function (e) {\n\n            // In case the user put the wrong value before, clean the style\n            e.target.classList.remove('total-input-error');\n            e.target.removeAttribute('data-toggle');\n            e.target.removeAttribute('data-placement');\n            e.target.removeAttribute('data-title');\n\n            const inputvalue = e.target.valueAsNumber;\n            const min = e.target.getAttribute('min');\n            const max = e.target.getAttribute('max');\n\n            if ((inputvalue != NaN) && (inputvalue < min || inputvalue > max)) {\n                e.target.classList.add('total-input-error');\n                e.target.setAttribute('data-toggle', 'tooltip');\n                e.target.setAttribute('data-placement', 'right');\n                e.target.setAttribute('data-title', 'Value out of range');\n            } else {\n                // Change the description in the JSON.\n                const criteria = FeditorHelper.getCriteriaJSON();\n                const criterion = FeditorHelper.getCriterionFromCriteriaCollection(e.target.parentNode.parentNode.parentNode, criteria);\n\n                criterion[0].sumscore = inputvalue;\n                FeditorHelper.setCriteriaJSON(criteria);\n                FeditorHelper.setHiddenCriteriaJSON(criteria);\n            }\n\n        }\n\n\n        return {\n            init: init\n        };\n    });"],"file":"criterion_control.min.js"}