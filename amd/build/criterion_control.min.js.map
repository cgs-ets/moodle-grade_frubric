{"version":3,"sources":["../src/criterion_control.js"],"names":["define","$","Log","Templates","Ajax","Str","Notification","LevelControl","FeditorHelper","CriterionControl","mode","id","self","LEVEL_ROW","prototype","main","debug","currentRow","document","getElementById","setupEvents","cgid","getAttribute","level","querySelector","init","error","actions","actionChildren","children","addEventListener","moveCriterionUp","bind","removeCriterion","addLevel","copyCriterion","getElementsByClassName","length","removeAttribute","description","editCriterionDescription","focusoutHandlerDisabled","resultRow","getNextElement","classList","remove","add","setAttribute","criterionTitletd","criterionTotaltd","validateTotal","row","criteriongroupid","currentCriterionInPlace","getPreviousElement","criteriontomove","Array","from","querySelectorAll","firstCriterion","rowIndex","notLastCriterion","criteriaCollection","getCriteriaJSON","filterCriterionToMove","filter","criterion","criteriongroupidfromCurrentInPlace","filterCriterionInPlace","riaux","rowindex","parentNode","insertBefore","moveCriterionDown","criterionToMove","criterionToMoveArray","criterionBelow","notlastCriterion","inBetween","randomid","Math","floor","random","context","render","done","html","prevlevel","classname","nextCriterion","prevresultlevel","insertAdjacentHTML","fail","ex","get_strings","key","component","strs","confirm","criTable","criterionToDelete","target","criteariaID","frc","JSON","parse","value","frctodel","index","status","levels","j","stringify","i","rows","className","elements","removeChild","deleteRow","e","stopPropagation","textarea","innerHTML","focus","changeCriterionHandlerDisabled","criterioncollection","filterCriterion","getMode","getClosest","elem","selector","matches","valueAsNumber","inputvalue","min","max","NaN","sibling","previousElementSibling","nextElementSibling","control"],"mappings":"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","sourcesContent":["/* eslint-disable capitalized-comments */\n/* eslint-disable max-len */\n// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n\n/**\n * @package   gradingform_frubric\n * @copyright 2021 Veronica Bermegui\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/log', 'core/templates', 'core/ajax', 'core/str', 'core/notification', 'gradingform_frubric/level_control', 'gradingform_frubric/feditor_helper'],\n    function ($, Log, Templates, Ajax, Str, Notification, LevelControl, FeditorHelper) {\n        'use strict';\n\n        function init(id) {\n            Log.debug('Criterion control...');\n            Log.debug(id);\n            const mode = FeditorHelper.getMode();\n            let control = new CriterionControl(mode, id);\n            control.main();\n        }\n\n        /**\n         *\n         * @param {*} mode\n         */\n        function CriterionControl(mode, id) {\n            const self = this;\n            self.LEVEL_ROW = 'gradingform_frubric/editor_level_row';\n            self.mode = mode;\n            self.id = id;\n        }\n\n        /**\n         * Run the controller.\n         *\n         */\n        CriterionControl.prototype.main = function () {\n            let self = this;\n            Log.debug(self);\n            const currentRow = document.getElementById(self.id);\n\n            if (self.mode == 'edit') { // Add the listeners to all the criterion rows.\n                try {\n                    self.setupEvents(currentRow);\n                    // Attach level listeners.\n                    const cgid = currentRow.getAttribute('data-criterion-group');\n                    const level = document.querySelector(`.level-${cgid}`);\n             \n                    LevelControl.init(level);\n\n                } catch (error) {\n                    Log.debug(error);\n                }\n\n            } else {\n              //  const currentRow = document.getElementById(self.id);//document.querySelector(\"tbody\"). firstElementChild; //lastElementChild; // Get the last row\n                self.setupEvents(currentRow);\n            }\n\n        };\n\n        CriterionControl.prototype.setupEvents = function (currentRow) {\n            let self = this;\n            Log.debug('setupEvents');\n            // Log.debug(self);\n            Log.debug(currentRow); \n            const actions = currentRow.querySelector('.act'); // Get actions cell\n            \n            if (!actions) {\n                return;\n            }\n\n            const actionChildren = actions.children;\n            Log.debug(\"actionChildren\");\n            Log.debug(actionChildren);\n            // Criterion actions.\n            actionChildren[0].addEventListener('click', self.moveCriterionUp.bind(self, currentRow));\n            actionChildren[1].addEventListener('click', self.removeCriterion.bind(currentRow));\n            actionChildren[2].addEventListener('click', self.addLevel.bind(self, currentRow));\n            actionChildren[3].addEventListener('click', self.copyCriterion);\n            // actionChildren[4].addEventListener('click', self.moveCriterionDown.bind(self, currentRow));\n\n            if (document.getElementsByClassName(\"criterion-header\").length > 1) { // There is at least one criterion.\n                // Display row up\n                actionChildren[0].removeAttribute('hidden');\n            }\n\n            const description = currentRow.querySelector('.crit-desc'); // Get description\n            description.addEventListener('click', self.editCriterionDescription.bind(this));\n            description.addEventListener('focusout', self.focusoutHandlerDisabled);\n\n            // Get the previous criterion to attach events to the total criterion row at the top of this one.\n            const resultRow = FeditorHelper.getNextElement(currentRow, '.result-r');\n            if (resultRow != undefined) {\n                const cgid = resultRow.getAttribute('data-criterion-group');\n\n                Log.debug(\"Result row\");\n                resultRow.classList.remove('level-'); // Remove the class without the id.\n                resultRow.classList.add(`level-${cgid}`);\n                resultRow.setAttribute('data-criterion-group', cgid); \n                Log.debug(resultRow);\n\n                const [criterionTitletd, criterionTotaltd] = resultRow.children;\n                Log.debug(criterionTitletd);\n                Log.debug(criterionTotaltd);\n                Log.debug(criterionTotaltd.querySelector('.total-input'));\n                criterionTotaltd.querySelector('.total-input').addEventListener('blur', self.validateTotal);\n                // TODO: ponerle los datos del criterion padre al criterion total.\n            }\n\n\n        };\n\n\n        CriterionControl.prototype.moveCriterionUp = function (row) {\n            Log.debug('moveCriterionUp');\n\n            const criteriongroupid = row.getAttribute('data-criterion-group');\n            const currentCriterionInPlace = this.getPreviousElement(row, '.criterion-header'); // Get the criterion on top of this one.\n            const criteriontomove = Array.from(document.querySelectorAll(`[data-criterion-group='${criteriongroupid}']`));\n            const firstCriterion = (currentCriterionInPlace.rowIndex == 0) ? true : false;\n            const notLastCriterion = this.getNextElement(document.querySelector(`[data-criterion-group='${criteriongroupid}']`), '.criterion-header');\n            const inBetween = !firstCriterion && !notLastCriterion;\n            const criteriaCollection = this.getCriteriaJSON();\n            // Get the criterion that will be moved and the one that is in place to update the rowIndex\n            Log.debug(\"criterioncollection\");\n            Log.debug(criteriaCollection);\n\n            const filterCriterionToMove = criteriaCollection.filter(function (criterion) {\n\n                if (criteriongroupid == criterion.id) {\n                    return criterion;\n                }\n            }, criteriongroupid);\n\n            const criteriongroupidfromCurrentInPlace = currentCriterionInPlace.getAttribute('data-criterion-group');\n            const filterCriterionInPlace = criteriaCollection.filter(function (criterion) {\n\n                if (criteriongroupidfromCurrentInPlace == criterion.id) {\n                    return criterion;\n                }\n            }, criteriongroupidfromCurrentInPlace);\n\n\n            // Update the row number\n            const riaux = filterCriterionToMove[0].rowindex;\n            filterCriterionToMove[0].rowindex = filterCriterionInPlace[0].rowindex;\n            filterCriterionInPlace[0].rowindex = riaux;\n\n            if (firstCriterion) {\n                criteriontomove[0].children[0].children[0].setAttribute('hidden', true);\n                currentCriterionInPlace.children[0].children[0].removeAttribute('hidden');\n            }\n            if (inBetween) {\n                criteriontomove[0].children[0].children[0].removeAttribute('hidden');\n                criteriontomove[0].children[0].children[4].removeAttribute('hidden');\n            }\n            if (!notLastCriterion) {\n                currentCriterionInPlace.children[0].children[4].setAttribute('hidden', true); // Its the last criterion, hide the down arrow.\n            }\n\n            try {\n                for (const level of criteriontomove) {\n                    currentCriterionInPlace.parentNode.insertBefore(level, currentCriterionInPlace);\n                }\n            } catch (error) {\n                Log.debug(error);\n            }\n\n        };\n\n        CriterionControl.prototype.moveCriterionDown = function (row) {\n            Log.debug('moveCriterionDown');\n\n            const criteriongroupid = row.getAttribute('data-criterion-group');\n            const criterionToMove = document.querySelector(`[data-criterion-group='${criteriongroupid}']`);\n            const firstCriterion = criterionToMove.rowIndex == 0 ? true : false;\n            const criterionToMoveArray = Array.from(document.querySelectorAll(`[data-criterion-group='${criteriongroupid}']`));\n            let criterionBelow = this.getNextElement(criterionToMove, '.criterion-header');\n            const notlastCriterion = this.getNextElement(criterionToMove, '.criterion-header');\n            const inBetween = !firstCriterion && (notlastCriterion != undefined);\n\n            Log.debug('firstCriterion', firstCriterion);\n            Log.debug('notlastCriterion', notlastCriterion);\n            Log.debug('inBetween', inBetween);\n\n            criterionBelow = criterionBelow.getAttribute('data-criterion-group');\n            criterionBelow = Array.from(document.querySelectorAll(`[data-criterion-group='${criterionBelow}']`));\n\n            if (firstCriterion) {\n                criterionBelow[0].children[0].children[0].setAttribute('hidden', true);\n                criterionBelow[0].children[0].children[4].removeAttribute('hidden');\n                // Check if the criterion below is the last one.\n                if (!this.getNextElement(criterionBelow, '.criterion-header')) {\n                    criterionToMoveArray[0].children[0].children[4].setAttribute('hidden', true);\n                }\n            }\n\n            if (firstCriterion && notlastCriterion != undefined) { // Moving the first criterion, its next position is in between\n                criterionToMoveArray[0].children[0].children[0].removeAttribute('hidden');\n            }\n\n            if (inBetween) {\n                criterionBelow[0].children[0].children[0].removeAttribute('hidden');\n                criterionBelow[0].children[0].children[4].removeAttribute('hidden');\n\n                // Check if the criterion below is the last one.\n                if (!this.getNextElement(criterionBelow, '.criterion-header')) {\n                    criterionToMoveArray[0].children[0].children[4].setAttribute('hidden', true);\n                }\n            }\n\n            if (notlastCriterion == undefined) { // The criterion below is the last one\n                criterionToMoveArray[0].children[0].children[0].removeAttribute('hidden');\n                criterionToMoveArray[0].children[0].children[4].setAttribute('hidden', true);\n            }\n\n            if (inBetween && notlastCriterion == undefined) {\n                criterionBelow[0].children[0].children[4].removeAttribute('hidden');\n            }\n\n            try {\n                for (const level of criterionBelow) {\n                    criterionToMove.parentNode.insertBefore(level, criterionToMove); // JS doesnt have an insertAfter. So we put the element below on top of the one the one we want to move\n                }\n            } catch (error) {\n                Log.debug(error);\n            }\n\n        };\n\n        CriterionControl.prototype.addLevel = function (row) {\n            Log.debug('addLevel');\n            let self = this;\n            const randomid = (Math.floor( Math.random() * 9999));\n            const context = {\n                'score': 'Click to edit Mark',\n                'definition': 'Click to edit Level description',\n                'dcg': row.getAttribute('data-criterion-group'),\n                'id' : randomid,\n            };\n\n            Templates.render(self.LEVEL_ROW, context)\n                .done(function (html, js) {\n\n                    var prevlevel;\n                    const classname = `.level-${row.getAttribute('data-criterion-group')}`;\n                    Log.debug(classname);\n                    let nextCriterion = FeditorHelper.getNextElement(row, '.criterion-header');\n\n                    Log.debug(nextCriterion);\n\n                    if (nextCriterion != undefined) { //  If there is another criterion the level is on top of this row\n\n                        const prevresultlevel = FeditorHelper.getPreviousElement(nextCriterion, '.result-r'); // The new level is on top of the result row for this criterion.\n                        Log.debug(\"prevresultlevel\");\n                        Log.debug(prevresultlevel);\n                        prevlevel = FeditorHelper.getPreviousElement(prevresultlevel, classname);\n\n                        if (prevlevel == undefined) { // If undefined, the criterion represented by row has no levels. Add the level under the current criterion\n                            prevlevel = row;\n                        }\n\n                    } else {\n                        prevlevel = FeditorHelper.getNextElement(row, classname);\n                        if (prevlevel == undefined) {  // There are already levels\n                            prevlevel = row;\n                        }\n                    }\n\n                    Log.debug(prevlevel);\n\n                    prevlevel.insertAdjacentHTML('afterend', html);\n\n\n                    LevelControl.init(randomid);\n                })\n                .fail(function (ex) {\n                    Log.debug(\"error...\");\n                    Log.debug(ex);\n                });\n\n            \n        };\n\n\n        CriterionControl.prototype.removeCriterion = function (row) {\n            Log.debug(\"remove...\");\n\n            Str.get_strings([{\n                    key: 'confirm',\n                    component: 'gradingform_frubric'\n                },\n                {\n                    key: 'confirmdeletecriterion',\n                    component: 'gradingform_frubric'\n                },\n                {\n                    key: 'yes'\n                },\n                {\n                    key: 'no'\n                },\n\n            ]).done(function (strs) {\n                Notification.confirm(strs[0], strs[1], strs[2], strs[3], function () {\n                    let criTable = document.getElementById('criteriaTable');\n                    let criterionToDelete = row.target.parentNode.parentNode.parentNode.parentNode.rowIndex;\n                    \n                    const criteariaID = row.target.parentNode.parentNode.parentNode.parentNode.getAttribute('data-criterion-group');\n\n                    // Change the criterion status tu DELETE, to be able to delete from the DB.\n                    let frc = JSON.parse(document.getElementById('id_criteria').value);\n\n                      // Change the description in the JSON\n                    const frctodel = frc.filter(function (criterion, index) {\n                        const criteariaID = this.getAttribute('data-criterion-group');\n                        criterion.rowindex = index;\n                        if (criteariaID == criterion.id) {\n                            return criterion;\n                        }\n                    }, row.target.parentNode.parentNode.parentNode.parentNode);\n\n                    Log.debug(\"TO DELETE\");\n                    frctodel[0].status = \"DELETE\";\n                    const levels = frctodel[0].levels;\n                    Log.debug(levels);\n                    // Change the status for the levels in this criterion\n                    \n                    for (let j = 0; j < levels.length; j++) {\n                        levels[j].status = \"DELETE\";\n                    }\n\n                    document.getElementById('id_criteria').value = JSON.stringify(frc);\n                    \n                    // Delete all the levels in that criterion.\n                    for (let i = (criterionToDelete + 1); i < criTable.rows.length; i++) {\n                        if (criTable.rows[i].getAttribute('data-criterion-group') == criteariaID) {\n                            criTable.rows[i].classList.add('to-remove'); // Tag the rows to delete.\n                        } else {\n                            break;\n                        }\n                    }\n\n                    removeElementsByClass('to-remove');\n                    // TODO: CHECK THE UP AND DOWN ARROWS ON THE ELEMENT THAT TAKES PLACE OF THE DELETED ONE\n                    // TODO: KEEP TRACK OF THE DELETED ELEMENTS IN CASE WE HAVE TO UPDATE THE DB.\n\n                    function removeElementsByClass(className) {\n                        var elements = document.getElementsByClassName(className);\n                        while (elements.length > 0) {\n                            elements[0].parentNode.removeChild(elements[0]);\n                        }\n                    }\n                    criTable.deleteRow(criterionToDelete);\n\n                }, function () {\n                    return;\n                });\n            });\n        };\n\n        CriterionControl.prototype.copyCriterion = function (e) {\n\n            Log.debug('copyCriterion');\n        };\n\n        CriterionControl.prototype.editCriterionDescription = function (e) {\n            e.stopPropagation();\n            Log.debug('edit criterion description');\n            let textarea = e.target;\n            if (textarea.innerHTML == 'Click to edit criterion') {\n                textarea.innerHTML = '';\n            }\n            textarea.removeAttribute('disabled');\n            textarea.focus();\n            textarea.addEventListener('change', this.changeCriterionHandlerDisabled.bind(this));\n        };\n\n\n        CriterionControl.prototype.focusoutHandlerDisabled = function (e) {\n            Log.debug(\"focusoutHandlerDisabled\");\n            Log.debug(this);\n            if (e.target.innerHTML == '') {\n                e.target.innerHTML = 'Click to edit criterion';\n            }\n            e.target.setAttribute('disabled', true);\n        };\n\n        CriterionControl.prototype.changeCriterionHandlerDisabled = function (e) {\n            Log.debug('changeCriterionHandlerDisabled');\n            Log.debug(e);\n\n            const criterioncollection = (document.getElementById('id_criteria').value) ? JSON.parse(document.getElementById('id_criteria').value) : [];\n\n            // Change the description in the JSON\n            const filterCriterion = criterioncollection.filter(function (criterion, index) {\n                const id = e.target.parentNode.parentNode.getAttribute('data-criterion-group');\n                criterion.rowindex = index;\n                if (id == criterion.id) {\n                    return criterion;\n                }\n            }, e);\n\n            Log.debug(filterCriterion);\n\n            if (filterCriterion[0].description != e.target.value && FeditorHelper.getMode() == 'edit') {\n                filterCriterion[0].status = 'UPDATE';\n            }\n\n            filterCriterion[0].description = e.target.value;\n            // Refresh the Criteria JSON input\n            document.getElementById('id_criteria').value = JSON.stringify(criterioncollection);\n\n        };\n\n        CriterionControl.prototype.getCriteriaJSON = function () {\n            return (document.getElementById('id_criteria').value) ? JSON.parse(document.getElementById('id_criteria').value) : [];\n        }; // TODO: borrar y usar el que cree en el helper\n\n        // Helper function to get the closest parent with a matching selector TODO: borrar y usar el que cree en el helper\n        CriterionControl.prototype.getClosest = function (elem, selector) {\n            for (; elem && elem !== document; elem = elem.parentNode) {\n                if (elem.matches(selector)) {\n                    return elem;\n                }\n            }\n            return null;\n        };\n\n        CriterionControl.prototype.validateTotal = function (e) {\n            Log.debug(e.target.valueAsNumber);\n            // In case the user put the wrong value before, clean the sty;e\n            e.target.classList.remove('total-input-error');\n            e.target.removeAttribute('data-toggle');\n            e.target.removeAttribute('data-placement');\n            e.target.removeAttribute('data-title');\n\n            const inputvalue = e.target.valueAsNumber;\n            const min = e.target.getAttribute('min');\n            const max = e.target.getAttribute('max');\n\n            if ((inputvalue != NaN) && (inputvalue < min || inputvalue > max)) {\n                e.target.classList.add('total-input-error');\n                e.target.setAttribute('data-toggle', 'tooltip');\n                e.target.setAttribute('data-placement', 'right');\n                e.target.setAttribute('data-title', 'Value out of range');\n            }\n        }\n\n\n        CriterionControl.prototype.getPreviousElement = function (elem, selector) {\n\n            // Get the previous sibling element\n            var sibling = elem.previousElementSibling;\n\n            // If there's no selector, return the first sibling\n            if (!selector) {\n                return;\n            }\n\n            // If the sibling matches our selector, use it\n            // If not, jump to the next sibling and continue the loop\n            while (sibling) {\n                if (sibling.matches(selector)) {\n                    return sibling;\n                }\n                sibling = sibling.previousElementSibling;\n            }\n        };\n\n        CriterionControl.prototype.getNextElement = function (elem, selector) {\n\n            // Get the next sibling element\n            var sibling = elem.nextElementSibling;\n            // If there's no selector, return\n            if (!selector) {\n                return;\n            }\n            // If the sibling matches our selector, use it\n            // If not, jump to the next sibling and continue the loop\n            while (sibling) {\n                if (sibling.matches(selector)) {\n                    return sibling;\n                }\n                sibling = sibling.nextElementSibling;\n            }\n        };\n\n\n        return {\n            init: init\n        };\n    });"],"file":"criterion_control.min.js"}