{"version":3,"sources":["../src/level_control.js"],"names":["define","$","Log","Str","Notification","FeditorHelper","Templates","LevelControl","level","mode","id","parentid","self","parentidaux","LEVEL_DESCRIPTOR_INPUT","LEVEL_DECRIPTORS_DELETE_SET","prototype","main","Y","log","classList","contains","editModeSetupEvents","nextElementSibling","validatePreviousMarkValue","setupEvents","getAttribute","previousElementSibling","children","del","markandesc","markdesctable","querySelector","firstcell","closest","addEventListener","deleteLevel","bind","rows","each","index","row","j","td","editmark","container","editModeSetupEventsHelper","addDescriptor","deleteSetCriterion","desciptorContainer","counter","length","descriptorIndex","lid","i","setAttribute","action","checkbox","descriptor","clickDescriptorHandler","deleteDescriptor","selectdescriptor","debug","marktd","descriptortd","e","score","target","innerHTML","remove","focus","changeMarkHandler","add","s","cleanPreviousMarkWarning","removeAttribute","el","document","getElementById","parentNode","removeChild","levelid","criteria","getCriteriaJSON","criterion","getCriterionFromCriteriaCollection","levelsdesc","getLevelDescriptors","value","nonum","test","error","message","previousRow","nextRow","indexOf","getMinMaxMark","min","max","parseFloat","setErrorMessage","groupid","includes","resultRow","total","split","maxinput","status","totaloutof","setCriteriaJSON","setHiddenCriteriaJSON","stopImmediatePropagation","preventDefault","descriptorContainer","getPreviousElement","positionLevel","getRandomID","editaddnewlevel","context","edit","poslevel","render","done","html","addDeleteSet","insertAdjacentHTML","lastChild","fail","lastElementChild","idtouse","desc","descriptors","push","checked","descText","delete","changeDescriptorHandler","containerid","Array","from","slice","d","checkboxcontainer","get_strings","key","component","strs","confirm","hasOwnProperty","countdeleted","forEach","parentElement","levels","splice","updateDescriptorIndex","descriptorindex","filter","l","deleteSingleDescriptorNotSavedInDB","tr","table","JSON","parse","fromRenderer","cl","Object","values","crit","descriptorids","data","descids","isArray","toString","deleteRow","rowIndex","criTable","crid","dbids","getDistanceFromCriterionHeader","dblevelid","cid","criterionid","editlevelhandler","textarea","changeLevelHandlerDisabled","focusoutHandlerDisabled","txtarea","levelrow","criterionheader","leveldbids","criteriaJSON","filterCriterion","rowindex","lev","critlevs","definition","criterionLevel","getMode","ids","obj","previousLevel","previousMark","countSelectedDescriptors","init","control"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n\n/**\n * @package   gradingform_frubric\n * @copyright 2021 Veronica Bermegui\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/log', 'core/str', 'core/notification', 'gradingform_frubric/feditor_helper', 'core/templates'],\n    function ($, Log, Str, Notification, FeditorHelper, Templates) {\n        'use strict';\n\n        function init(id, parentid) {\n          \n            const mode = FeditorHelper.getMode();\n            const level = document.getElementById(id);\n\n            let control = new LevelControl(level, mode, id, parentid);\n            control.main();\n\n        }\n\n\n        /**\n         *\n         * @param {*} level\n         * @param {*} mode\n         */\n        function LevelControl(level, mode, id, parentid) {\n            const self = this;\n            self.level = level;\n            self.mode = mode;\n            self.id = id;\n            self.parentid = parentid;\n            self.parentidaux = parentid;\n            self.LEVEL_DESCRIPTOR_INPUT = 'gradingform_frubric/level_descriptor_input';\n            self.LEVEL_DECRIPTORS_DELETE_SET = 'gradingform_frubric/level_decriptors_delete_set';\n        }\n\n        /**\n         * Run the controller.\n         */\n        LevelControl.prototype.main = function () {\n            let self = this;\n            Y.log(\"LEVEL CONTROL..., main\");\n            Y.log(self.level);\n            Y.log(self);\n\n            if (self.mode == 'edit') {\n                if (self.level.classList.contains('criterion-header')) {\n                    self.editModeSetupEvents(self.level.nextElementSibling); //self.level.nextElementSibling\n                } else {\n                    self.editModeSetupEvents(self.level);\n                }\n            } else {\n                if (self.level != null) {\n                    self.validatePreviousMarkValue() // CASE: last level  has 0 mark. A new level is added, previous level can't be zero. As 0 is only allowed for the last level,\n                    self.setupEvents(self.level);\n                }\n            }\n\n        };\n\n        LevelControl.prototype.editModeSetupEvents = function (level) {\n\n         \n            const self = this;\n\n            if (level.getAttribute('data-row-type') == 'result' || level.getAttribute('data-row-type') == 'add-level-r') { // get the current level. Its the new level added.  \n                level = level.previousElementSibling;\n            }\n           \n\n            const [del, markandesc] = level.children;\n\n            const markdesctable = markandesc.querySelector('.level-mark-desc-table');\n\n            if (markdesctable) {\n                var  firstcell = markdesctable.closest('tr'); // Get the delete column for the entire level.\n                firstcell = $(firstcell).children('td:first')[0];\n                firstcell.querySelector('.action-el').addEventListener('click', self.deleteLevel.bind(self));\n\n                let rows = markdesctable.rows;\n                $(rows).each(function (index, row) {\n                   \n                    $(row).children().each(function (j, td) {\n                        if (td.classList.contains('level-mark')) {\n                            td.querySelector('.level-mark > textarea').addEventListener('focus', self.editmark.bind(self));\n                        }\n\n                        $(td).children().each(function (i) {\n\n                            const container = this;\n\n                            if (container.classList.contains('standard-desc-container')) {\n\n                                self.editModeSetupEventsHelper(container);\n                            }\n\n                            if (container.classList.contains('add-descriptor')) {\n                                container.querySelector('.add-desc-btn').addEventListener('click', self.addDescriptor.bind(self)); //.bind(self)\n                            }\n\n                            if (container.classList.contains('action-delete-set-desc')) {\n\n                                container.addEventListener('click', self.deleteSetCriterion.bind(self));\n                            }\n\n                        });\n\n                    })\n\n                });\n            }\n\n\n        }\n\n        LevelControl.prototype.editModeSetupEventsHelper = function (desciptorContainer) {\n\n            var self = this;\n            let counter = 0;\n            counter = desciptorContainer.children.length;\n\n            if (counter > 0) { // All the descriptors for this level where deleted previously.\n\n                self.descriptorIndex = counter;\n                self.parentid = desciptorContainer.children[0].getAttribute('data-parent-id');\n                self.lid = desciptorContainer.children[0].getAttribute('id');\n\n                $(desciptorContainer).each(function (i, td) {\n                    $(td).children().each(function (i) {\n\n                        const container = this;\n\n                        if (container.classList.contains('fmark')) {\n                            return;\n                        }\n\n                        container.setAttribute('descriptor-index', i);\n                        const action = container.querySelector('.action-el');\n                        const checkbox = container.querySelector('.standard-check');\n                        const descriptor = container.querySelector('.standard-desc');\n\n                        /**Add focus and click events to the descriptor. SO it always picks up the change */\n                        descriptor.addEventListener('click', self.clickDescriptorHandler.bind(this, self));\n                        descriptor.addEventListener('focus', self.clickDescriptorHandler.bind(this, self));\n                        action.addEventListener('click', self.deleteDescriptor.bind(self, descriptor, container));\n                        checkbox.addEventListener('click', self.selectdescriptor.bind(this, self));\n\n                    });\n                });\n            }\n        }\n\n        LevelControl.prototype.setupEvents = function (level) {\n            Log.debug(\"Level control: setupEvents\");\n            \n            let self = this;\n            const [del, markandesc] = level.children;\n            const markdesctable = markandesc.querySelector('.level-mark-desc-table');\n\n            if (markdesctable) {\n\n                const [marktd, descriptortd] = markdesctable.rows[0].children;\n                marktd.querySelector('.level-mark > textarea').addEventListener('focus', self.editmark.bind(self));\n\n                if (self.mode != 'edit') {\n                    descriptortd.querySelector('.add-desc-btn').addEventListener('click', self.addDescriptor.bind(self));\n                }\n\n                del.addEventListener('click', self.deleteLevel.bind(self));\n            }\n\n        };\n\n        LevelControl.prototype.editmark = function (e) {\n            Log.debug(\"editmark...\");\n\n            const self = this;\n            const score = e.target;\n\n            if (score.innerHTML == '[Min - Max]') {\n                score.innerHTML = '';\n            }\n\n            if (e.target.classList.contains('is-invalid')) {\n                e.target.classList.remove('is-invalid');\n                e.target.classList.remove('form-control');\n            }\n\n            score.focus();\n\n            if (!score.classList.contains('changeh')) {\n                score.addEventListener('change', self.changeMarkHandler.bind(this, self));\n                score.classList.add('changeh');\n            }\n\n\n        }\n\n        LevelControl.prototype.changeMarkHandler = function (s, e) {\n            Log.debug(\"changeMarkHandler\");\n\n            // If it came from validatePreviousMarkValue we need to remove the class warning\n            s.cleanPreviousMarkWarning();\n            // Remove error message if the user inserted wrong data before.\n            e.target.classList.remove('total-input-error');\n            e.target.removeAttribute('data-toggle');\n            e.target.removeAttribute('data-placement');\n            e.target.removeAttribute('data-title');\n\n            const el = document.getElementById(e.target.getAttribute('aria-describedby'));\n\n            if (el != null) {\n                el.parentNode.removeChild(el);\n                e.target.removeAttribute('data-original-title');\n                e.target.removeAttribute('title');\n                e.target.removeAttribute('aria-describedby');\n\n            }\n\n            var levelid;\n            if (e.target.getAttribute('data-level-id') != null) {\n                levelid = e.target.getAttribute('data-level-id');\n            }\n            // Update the score for this criterion.\n            const criteria = FeditorHelper.getCriteriaJSON();\n            const criterion = FeditorHelper.getCriterionFromCriteriaCollection(document.getElementById(s.id), criteria);\n            const levelsdesc = s.getLevelDescriptors(s.id, criteria, levelid);\n            const score = e.target.value;\n            const nonum = /[a-z]/gi.test(e.target.value);\n\n            let error = false;\n            let message = '';\n\n            if (nonum) {\n                error = true;\n                message = 'Please insert a number value range';\n            } else if (score == 0) {\n                // First check if its 0. This value is valid in the last row. Meaning the student didnt reach the min. standard\n                // Only the last row can score 0.\n                // Check its the last by checking the next sibling => it has to be the result row.\n                // Check prevoious sibling => It has to be a leevl row\n                const previousRow = (document.getElementById(s.id).previousElementSibling).getAttribute('data-row-type');\n                const nextRow = (document.getElementById(s.id).nextElementSibling).getAttribute('data-row-type');\n\n                if (!(previousRow == 'level' && nextRow == 'result')) {\n                    error = true;\n                    message = 'Zero mark only allowed in last level'\n                }\n\n            } else {\n\n                if (score.indexOf('-') == -1 && score.indexOf('/') == -1) {\n                    error = true;\n                    message = 'Invalid value. Accepts min-max or min/max';\n                } else {\n                    // Evaluate min/max \n                    var [min, max] = s.getMinMaxMark(score); // TODO: use the feditorhelper version\n                    if (min.length == 0 || max.length == 0) {\n                        error = true;\n                    } else if ((min.length > 0 && max.length > 0) && (parseFloat(min) > parseFloat(max))) {\n                        error = true;\n                        message = 'Min value is greater than max value';\n                    }\n\n                }\n            }\n\n            if (error) {\n                s.setErrorMessage(e, message);\n                error = false;\n                return;\n            }\n\n            var groupid;\n\n            // Update the total result input. with the highest value.\n            if (!s.parentid.includes('frubric-criteria-NEWID')) {\n                groupid = document.getElementById(s.id).getAttribute('data-criterion-group');\n            } else {\n                groupid = document.getElementById(s.parentid).getAttribute('data-criterion-group');\n            }\n\n            const resultRow = document.querySelector(`[data-criterion-group=\"${groupid}\"][data-row-type=\"result\"]`);\n            var total = (resultRow.querySelector(`#out-of-value-${groupid}`).innerHTML).split(\"/\");\n            const maxinput = resultRow.querySelector('.total-input');\n\n            levelsdesc[0].score = e.target.value;\n            if (levelsdesc[0].status == 'CREATED' || levelsdesc[0].status == 'UPDATED') {\n                levelsdesc[0].status = 'UPDATE';\n            }\n            total = total[total.length - 1];\n\n            if (total === \"\") { //  Its the first value available.\n                resultRow.querySelector(`#out-of-value-${groupid}`).innerHTML = `/${max}`;\n                total = max;\n\n            } else { // check if the max we have has to be replaced by a new max\n\n                if (parseFloat(total) < max) {\n                    total = max;\n                    resultRow.querySelector(`#out-of-value-${groupid}`).innerHTML = `/${max}`;\n                }\n            }\n\n            // Update the max attribute.\n            maxinput.setAttribute(\"max\", total);\n            criterion[0].totaloutof = total;\n\n            FeditorHelper.setCriteriaJSON(criteria);\n            FeditorHelper.setHiddenCriteriaJSON(criteria);\n\n\n        }\n\n        LevelControl.prototype.addDescriptor = function (e) {\n            const self = this;\n            e.stopImmediatePropagation();\n            e.preventDefault();\n\n            // Get the standard-desc-container  that contains the descritors.\n            const descriptorContainer = FeditorHelper.getPreviousElement(e.target.parentNode, '.standard-desc-container');\n            var positionLevel = 0;\n\n            let id;\n            if ((self.mode != 'edit') || descriptorContainer.children.length == 0) {\n                id = `${self.id}-${FeditorHelper.getRandomID()}`;\n                positionLevel = descriptorContainer.children.length; // By adding the delete set \n            } else {\n                id = `${self.id}-${descriptorContainer.children[0].getAttribute('id')}`;\n            }\n\n            if (descriptorContainer.children.length > 0) { //self.mode == 'create' &&\n                positionLevel = descriptorContainer.children.length - 1; // When we add the first element, the delete set span is addedd too. we need to only count the divs t oget the right index.\n            }\n\n            Y.log(\"self.parentid\");\n            Y.log(self.parentid);\n\n            Y.log(this);\n            if (self.parentid == undefined) { // Level with no descriptor, User clicked save anf make it ready\n                var editaddnewlevel = false;\n                \n            } else if (self.parentid.includes('frubric-criteria-NEWID')) {\n                editaddnewlevel = self.parentid.includes('frubric-criteria-NEWID');\n            }\n           \n            Y.log(editaddnewlevel);\n            const context = {\n                id: id,\n                parentid: self.parentid,\n                edit: self.mode == 'edit',\n                editaddnewlevel: editaddnewlevel,\n                index: descriptorContainer.children.length,\n                poslevel: positionLevel\n            };\n\n\n            if (self.mode != 'edit') {\n                delete context.index;\n            }\n\n            Templates.render(self.LEVEL_DESCRIPTOR_INPUT, context)\n                .done(function (html, js) {\n\n                    let addDeleteSet = false;\n                    if (descriptorContainer.children.length == 0) {\n                        addDeleteSet = true\n                    }\n                    descriptorContainer.insertAdjacentHTML('beforeend', html);\n\n                    if (addDeleteSet) {\n                        descriptorContainer.insertAdjacentHTML(\"afterbegin\", '  <span class=\"action-delete-set-desc  first-time-render\"> <i class=\"fa fa-close  first-time-render\" title=\"Delete set of descriptors\"></i></span>');\n                        descriptorContainer.querySelector('.action-delete-set-desc').addEventListener('click', self.deleteSetCriterion.bind(self));\n                    }\n\n                    const container = descriptorContainer.lastChild;\n                    const action = container.querySelector('.action-el');\n                    const checkbox = container.querySelector('.standard-check');\n                    const descriptor = container.querySelector('.standard-desc');\n\n                    descriptor.addEventListener('click', self.clickDescriptorHandler.bind(this, self));\n                    descriptor.addEventListener('focus', self.clickDescriptorHandler.bind(this, self));\n                    action.addEventListener('click', self.deleteDescriptor.bind(self, descriptorContainer, container));\n                    checkbox.addEventListener('click', self.selectdescriptor.bind(this, self));\n\n                })\n                .fail(function (ex) {\n                    Log.debug(\"error...\");\n                });\n\n\n            let criteria = FeditorHelper.getCriteriaJSON();\n            let container = descriptorContainer.lastElementChild;\n\n            var levelsdesc = ''; //self.getLevelDescriptors(self.parentid, criteria, self.id);\n\n            if (self.lid != undefined) {\n                levelsdesc = self.getLevelDescriptors(self.parentid, criteria, self.lid);\n            } else {\n                levelsdesc = self.getLevelDescriptors(self.parentid, criteria, self.id);\n            }\n            if (container != null) {\n                \n                Y.log(\"container..\");\n                Y.log(container);\n    \n                var idtouse = container.getAttribute('id');\n                \n                if (idtouse.includes(\"-\")) { // we are creating a new criterion. the id  is a random number XXX-XXX  the first XXX is the id that is set in the level id\n                    idtouse = idtouse.split(\"-\")[0];\n                } \n             \n                levelsdesc = self.getLevelDescriptors(self.parentid, criteria, container.getAttribute('id'));\n             \n                const desc = levelsdesc[0].descriptors;\n    \n                desc.push({\n                    checked: false,\n                    descText: '',\n                    delete: 0\n                });\n    \n                FeditorHelper.setCriteriaJSON(criteria);\n              \n                FeditorHelper.setHiddenCriteriaJSON(criteria);\n            }\n        }\n\n\n\n        LevelControl.prototype.clickDescriptorHandler = function (s, e) {\n            Log.debug('clickDescriptorHandler...');\n\n            let descriptor = e.target;\n            descriptor.focus();\n            // Attach change event\n            descriptor.addEventListener('change', s.changeDescriptorHandler.bind(this, s));\n            // If you copy and paste content without clicking it doesnt pick up the change. Add paste event\n            descriptor.addEventListener('paste', s.changeDescriptorHandler.bind(this, s));\n\n        }\n\n        LevelControl.prototype.changeDescriptorHandler = function (s, e) {\n            Log.debug(\"changeDescriptorHandler\");\n\n            const criteria = FeditorHelper.getCriteriaJSON();\n            const containerid = e.target.getAttribute('data-container-id');\n            let levelid;\n            let flag = false;\n\n            if (e.target.classList.contains('is-invalid')) {\n                e.target.classList.remove('is-invalid');\n                e.target.classList.remove('form-control');\n            }\n\n            let descriptorIndex = e.target.parentNode.getAttribute('descriptor-index');\n\n            if (descriptorIndex != null) {\n                levelid = e.target.parentNode.getAttribute('id');\n            } else {\n                descriptorIndex = Array.from(document.getElementById(containerid).parentNode.children).indexOf(e.target.parentNode) - 1;\n            }\n            // We are adding a descriptor to a level that is already in the DB. Make sure is not a rerender for failing\n            if (levelid != undefined && levelid.includes(\"-\") && !document.getElementById('id_criteria').classList.contains('is-invalid')) {\n                levelid.slice(levelid.indexOf('-') + 1, levelid.length);\n                flag = true;\n\n            }\n\n            const levelsdesc = s.getLevelDescriptors(s.id, criteria, levelid);\n            const desc = levelsdesc[0].descriptors[descriptorIndex];\n\n            if (desc == undefined) { // New entry\n\n                levelsdesc[0].descriptors.push({\n                    checked: false,\n                    descText: e.target.value,\n                    delete: 0\n                });\n\n\n            } else { // Existing entry, update text.\n\n                desc.descText = e.target.value;\n\n\n                if (levelsdesc[0].status == 'CREATED' || levelsdesc[0].status == 'UPDATED') {\n                    levelsdesc[0].status = 'UPDATE';\n                }\n            }\n\n\n            FeditorHelper.setCriteriaJSON(criteria);\n            FeditorHelper.setHiddenCriteriaJSON(criteria);\n\n        }\n\n        LevelControl.prototype.selectdescriptor = function (e, s) {\n            Log.debug(\"selectdescriptor\");\n\n            const containerid = s.target.getAttribute('data-container-id');\n            const criteria = FeditorHelper.getCriteriaJSON();\n            let levelsdesc;\n            let descriptorIndex = s.target.parentNode.getAttribute('descriptor-index');\n\n            if (descriptorIndex != null) {\n                const levelid = s.target.parentNode.getAttribute('id');\n                levelsdesc = e.getLevelDescriptors(e.id, criteria, levelid);\n            } else {\n                descriptorIndex = Array.from(document.getElementById(containerid).parentNode.children).indexOf(s.target.parentNode);\n                levelsdesc = e.getLevelDescriptors(e.id, criteria);\n            }\n\n            const d = levelsdesc[0].descriptors[descriptorIndex];\n            d.checked = s.target.checked;\n\n            // check if its already in the DB, if so, change the status\n            if (levelsdesc[0].status == 'CREATED' || levelsdesc[0].status == 'UPDATED') {\n                levelsdesc[0].status = 'UPDATE';\n            }\n            // Update the input.\n            FeditorHelper.setCriteriaJSON(criteria);\n            FeditorHelper.setHiddenCriteriaJSON(criteria);\n        }\n\n        LevelControl.prototype.deleteDescriptor = function (descriptorContainer, checkboxcontainer) {\n            Log.debug('deleteDescriptor');\n            var self = this;\n            if (checkboxcontainer.getAttribute('descriptor-index')) { // This means the descriptor is already saved in the BD. ask if theya re sure to remove\n\n                Str.get_strings([{\n                        key: 'confirm',\n                        component: 'gradingform_frubric'\n                    },\n                    {\n                        key: 'confirmdeletedescriptor',\n                        component: 'gradingform_frubric'\n                    },\n                    {\n                        key: 'yes'\n                    },\n                    {\n                        key: 'no'\n                    },\n\n                ]).done(function (strs) {\n                    Notification.confirm(strs[0], strs[1], strs[2], strs[3], function () {\n                        Log.debug(\"Notification...\");\n\n                        const criteria = FeditorHelper.getCriteriaJSON();\n                        const levelid = checkboxcontainer.getAttribute('id');\n                        const parentid = self.id;\n                        const descriptorIndex = checkboxcontainer.getAttribute('descriptor-index');\n\n                        const levelsdesc = self.getLevelDescriptors(parentid, criteria, levelid);\n                        const d = levelsdesc[0].descriptors[descriptorIndex];\n\n                        // Check that the descriptor you want to delete was saved in the DB.\n                        // Else, you just have to remove it and update the JSON to avoid updates to the level.\n                        if (d.hasOwnProperty('descriptorid')) {\n                            d.delete = 1;\n                          //  Y.log(levelsdesc);\n                            levelsdesc[0].status = 'UPDATE';\n\n                            let countdeleted = 0;\n                            levelsdesc[0].descriptors.forEach(function (desc, index) {\n                                if (desc.delete == 1) {\n                                    countdeleted++;\n                                }\n                            }, countdeleted);\n\n                            // Check if its the only descritor in the level. If it is, then remove the level completely\n                            if (levelsdesc[0].descriptors.length == countdeleted) {\n                                const checkboxaux = checkboxcontainer;\n                                const tbody = checkboxaux.parentElement.parentElement.parentElement.parentElement;\n\n                                //levelcontainer.remove();\n                                levelsdesc[0].status = 'DELETE';\n\n                                // Check if the definition only has one criterion. If it does, and the level is removed. then the criterion has to be deleted too\n                                if (criteria.length == 1) {\n                                    criteria[0].status = 'DELETE';\n                                }\n\n                                criteria.forEach(function (criterion) {\n                                    if (criterion.id == parentid) {\n                                        if (criterion.levels.length == 1) { // There is only one level in this criterion. Check if the descriptor has info. \n                                            criterion.status = 'DELETE'\n\n                                        } else {\n                                            criterion.status = 'UPDATE'\n                                        }\n                                    }\n                                }, parentid);\n\n\n                            }\n                        } else {\n                            levelsdesc[0].descriptors.splice(descriptorIndex, 1);\n                            self.updateDescriptorIndex(descriptorContainer);\n                        }\n\n                        checkboxcontainer.remove();\n\n                        // Update the input.\n                        FeditorHelper.setCriteriaJSON(criteria);\n                        FeditorHelper.setHiddenCriteriaJSON(criteria);\n\n\n                    }, function () {\n                        // For the cancel btn.\n                        return;\n                    });\n                });\n\n            } else {\n\n                const descriptorindex = checkboxcontainer.getAttribute('data-pos-level');\n                const parentid = self.id;\n                const criteria = FeditorHelper.getCriteriaJSON();\n                const row = document.getElementById(parentid);\n                const criterion = FeditorHelper.getCriterionFromCriteriaCollection(row, criteria);\n                const level = criterion[0].levels.filter(function (l) {\n                    if (l.id == parentid) {\n                        return l.descriptors;\n                    }\n                }, parentid);\n\n                const descriptors = (level[0]).descriptors;\n                descriptors.splice(descriptorindex, 1);\n                descriptorContainer.removeChild(checkboxcontainer);\n                self.updateDescriptorIndex(descriptorContainer);\n\n                // UPDATE JSON\n                FeditorHelper.setCriteriaJSON(criteria);\n                FeditorHelper.setHiddenCriteriaJSON(criteria);\n\n            }\n        };\n\n        LevelControl.prototype.deleteSingleDescriptorNotSavedInDB = function (checkboxcontainer) {\n\n            const descriptorindex = checkboxcontainer.getAttribute('data-pos-level');\n            const parentid = self.id;\n            const criteria = FeditorHelper.getCriteriaJSON();\n            const row = document.getElementById(parentid);\n            const criterion = FeditorHelper.getCriterionFromCriteriaCollection(row, criteria);\n            const level = criterion[0].levels.filter(function (l) {\n                if (l.id == parentid) {\n                    return l.descriptors;\n                }\n            }, parentid);\n\n            const descriptors = (level[0]).descriptors;\n            descriptors.splice(descriptorindex, 1);\n            descriptorContainer.removeChild(checkboxcontainer);\n            self.updateDescriptorIndex(descriptorContainer);\n            // UPDATE JSON\n            FeditorHelper.setCriteriaJSON(criteria);\n            FeditorHelper.setHiddenCriteriaJSON(criteria);\n        }\n\n\n        LevelControl.prototype.updateDescriptorIndex = function (descriptorContainer) {\n\n            $(descriptorContainer).children('div.checkbox-container').each(function (i) {\n                this.setAttribute('data-pos-level', i);\n            });\n        }\n\n\n\n        LevelControl.prototype.deleteSetCriterion = function (e) {\n            Y.log(\"deleteSetCriterion\");\n\n            Str.get_strings([{\n                    key: 'confirm',\n                    component: 'gradingform_frubric'\n                },\n                {\n                    key: 'confirmdeletesetcriterion',\n                    component: 'gradingform_frubric'\n                },\n                {\n                    key: 'yes'\n                },\n                {\n                    key: 'no'\n                },\n\n            ]).done(function (strs) {\n                Notification.confirm(strs[0], strs[1], strs[2], strs[3], function () {\n                   // Y.log(e.target.classList.contains(\"first-time-render\"));\n                    const tr = e.target.closest('tr'); // get the tr this element is in\n                    const table = e.target.closest('.level-mark-desc-table');\n                    const criteria = JSON.parse(document.getElementById('id_criteria').value);\n                    const fromRenderer = e.target.classList.contains(\"first-time-render\"); // When adding a new descriptor that was not saved in the db, just delete it.\n\n                    if (table.rows.length == 1) {\n                        const level = table.closest(\"[data-criterion-group]\");\n\n                        if (!fromRenderer) {\n                            criteria.forEach(function (criterion) {\n                                if (criterion.id == level.getAttribute('data-criterion-group')) {\n                                    criterion.status = 'DELETE';\n\n                                    const cl = Object.values(criterion.levels);\n                                    cl.forEach(function (level) {\n                                        level.status = 'DELETE';\n                                    });\n                                }\n                            });\n\n                        }\n\n                        level.remove();\n\n                    } else {\n\n                        // It has a few levels. \n                        const crit = tr.closest(\"[data-criterion-group]\"); // This row has the criterion these levels belong to\n                        const descriptors = Array.from(e.target.parentNode.nextElementSibling.children);\n                        const descriptorids = [];\n\n                        descriptors.forEach(function (desc) {\n                            descriptorids.push(desc.id);\n                        }, descriptorids);\n\n                        const data = {\n                            crit: crit,\n                            descids: descriptorids\n                        }\n\n                        if (!fromRenderer) {\n                            criteria.forEach(function (criterion) {\n                                if (criterion.id == data.crit.getAttribute('data-criterion-group')) {\n                                    criterion.status = 'UPDATE';\n\n                                    if (!Array.isArray(criterion.levels)) { // Check if the criteria has levels\n                                        criterion.levels = Object.values(criterion.levels);\n                                    }\n                                    criterion.levels.forEach(function (level) {\n\n                                        if (data.descids.includes((level.id).toString())) {\n\n                                            level.descriptors.forEach(function (d) {\n                                                d.delete = 1;\n                                            });\n                                            level.status = 'DELETE';\n\n                                        }\n                                    }, data.descids);\n\n                                }\n                            }, data);\n                        }\n\n                        table.deleteRow(tr.rowIndex);\n                        // Controlar que el max value  refleje el maximo si hay cambios\n                    }\n\n                    // document.getElementById('id_criteria').value = JSON.stringify(criteria);\n                    FeditorHelper.setCriteriaJSON(criteria);\n                    FeditorHelper.setHiddenCriteriaJSON(criteria);\n\n                }, function () {\n                    // For the cancel btn.\n                    return;\n                });\n            });\n        }\n\n        LevelControl.prototype.deleteLevel = function (e) {\n            Log.debug('deleteLevel');\n\n            Str.get_strings([{\n                    key: 'confirm',\n                    component: 'gradingform_frubric'\n                },\n                {\n                    key: 'confirmdeletelevel',\n                    component: 'gradingform_frubric'\n                },\n                {\n                    key: 'yes'\n                },\n                {\n                    key: 'no'\n                },\n\n            ]).done(function (strs) {\n                Notification.confirm(strs[0], strs[1], strs[2], strs[3], function () {\n                   \n                    let criTable = document.getElementById('criteriaTable');\n                    const tr = e.target.parentNode.parentNode.parentNode;\n                    const criterion = FeditorHelper.getPreviousElement(tr, '.criterion-header');\n                    let criteria = FeditorHelper.getCriteriaJSON();\n                    const crid = tr.getAttribute('data-criterion-group')\n\n                  \n                    if (criterion.getAttribute('data-criterion-levels').length > 0) {\n                       \n                        const dbids = JSON.parse(criterion.getAttribute('data-criterion-levels')); // These are the ids of the levels given by the DB.\n                        const index = FeditorHelper.getDistanceFromCriterionHeader(tr, '.criterion-header');\n                        const dblevelid = dbids[index];\n                      \n\n                        var levels;\n\n                        for (let i = 0; i < criteria.length; i++) {\n                            if (criteria[i].id == crid) {\n                                criteria[i].status = 'UPDATE';\n                                levels = criteria[i].levels;\n                                break;\n                            }\n                        }\n\n                        for (let j = 0; j < levels.length; j++) {\n                            if (levels[j].id == dblevelid) {\n                                levels[j].status = 'DELETE';\n                                break;\n                            }\n                        }\n\n                    } else {\n\n                        // The Criteria has not been saved. No need to send it to the DB.\n                       \n                        const tr = e.target.closest('tr');\n                        const lid = tr.getAttribute('id');\n                        const cid = criterion.getAttribute('id');\n\n                        \n                        const d = {levelid: lid, criterionid: cid}\n                        criteria.forEach(function (criterion) {\n                            if (criterion.cid == d.criterionid) {\n                                criterion.levels = criterion.levels.filter(function (level, index) {\n                                    level.id != d.lid;\n                                }, d)\n                            }\n                        }, d);\n                      \n                    }\n\n\n                    FeditorHelper.setCriteriaJSON(criteria);\n                    FeditorHelper.setHiddenCriteriaJSON(criteria);\n                    criTable.deleteRow(tr.rowIndex);\n\n\n                }, function () {\n                    // For the cancel btn.\n                    return;\n                });\n            });\n        };\n\n        LevelControl.prototype.editlevelhandler = function (e) {\n            Log.debug('editlevelhandler');\n            let textarea = e.target;\n\n            textarea.removeAttribute('disabled');\n            textarea.focus();\n            textarea.addEventListener('change', this.changeLevelHandlerDisabled.bind(this, textarea));\n            textarea.addEventListener('focusout', this.focusoutHandlerDisabled);\n        };\n\n        LevelControl.prototype.changeLevelHandlerDisabled = function (txtarea, e) {\n            Log.debug('changeLevelHandlerDisabled');\n\n            let id = e.target.parentNode.parentNode.parentNode.getAttribute('data-criterion-group');\n            const levelrow = e.target.parentNode.parentNode.parentNode;\n\n            // Get the criterion row this level belongs to\n            const criterionheader = FeditorHelper.getPreviousElement(levelrow, '.criterion-header');\n            let leveldbids = criterionheader.getAttribute('data-criterion-levels').length > 0 ? JSON.parse(criterionheader.getAttribute('data-criterion-levels')) : []; // Get the dbids\n\n            const criteriaJSON = FeditorHelper.getCriteriaJSON();\n            const rowIndex = e.target.parentNode.parentNode.parentNode.rowIndex;\n\n            let levelid = id + '_' + rowIndex;\n\n            if (leveldbids.length > 0) {\n                levelid = (leveldbids[rowIndex - 1] != undefined) ? `${id}_${leveldbids[rowIndex - 1]}` : levelid; // The criterion already exists but this is a new level, not saved in the DB yet.\n            }\n\n            const filterCriterion = criteriaJSON.filter(function (criterion, index) {\n                const id = e.target.parentNode.parentNode.parentNode.getAttribute('data-criterion-group');\n                criterion.rowindex = index;\n                if (id == criterion.id) {\n                    return criterion;\n                }\n            }, e);\n\n            // Find the level and update the values\n            if (filterCriterion[0].levels != undefined) {\n                var lev = null;\n                const critlevs = filterCriterion[0].levels;\n\n                for (let i = 0; i < critlevs.length; i++) {\n\n                    if ((critlevs[i]).id != levelid) {\n                        continue;\n                    } else {\n                        lev = critlevs[i];\n                        break;\n\n                    }\n                }\n\n                if (lev != null) {\n                    if (e.target.classList.contains('mark_txtarea')) {\n                        lev.score = e.target.value;\n                    } else {\n                        lev.definition = e.target.value;\n                    }\n                    if (lev.status == 'CREATED' || lev.status == 'UPDATED') { // It was updated before. \n                        lev.status = 'UPDATE';\n                    }\n\n                } else {\n\n                    let criterionLevel = {\n                        id: levelid,\n                        status: 'NEW',\n                        score: '',\n                        definition: ''\n                    };\n\n                    if (e.target.classList.contains('mark_txtarea')) {\n                        criterionLevel.score = e.target.value;\n                    } else {\n                        criterionLevel.definition = e.target.value;\n                    }\n                    (filterCriterion[0]).levels.push(criterionLevel);\n                }\n\n                if (FeditorHelper.getMode() == 'edit') {\n\n                    if (filterCriterion[0].cid.includes(\"NEWID\") != true) { // A new criterion added\n                        filterCriterion[0].status = \"UPDATE\"; // The criterion was updated because it has new levels.\n                    } else {\n                        filterCriterion[0].status = \"NEW\";\n                    }\n                }\n\n            }\n\n          \n            FeditorHelper.setCriteriaJSON(criteriaJSON);\n            FeditorHelper.setHiddenCriteriaJSON(criteriaJSON);\n\n\n\n            e.target.setAttribute('disabled', true);\n        };\n\n        LevelControl.prototype.focusoutHandlerDisabled = function (e) {\n            Log.debug('focusoutHandlerDisabled');\n            e.target.setAttribute('disabled', true);\n        };\n\n        LevelControl.prototype.getLevelDescriptors = function (parentid, criteria, levelid) {\n            Log.debug(\"getLevelDescriptors...\");\n\n            var self = this;\n            let row = document.getElementById(parentid);\n\n            if (document.getElementById(parentid) == null) {\n                row = document.getElementById(self.level.id);\n            }\n\n          \n            Y.log(this);\n\n            const criterion = FeditorHelper.getCriterionFromCriteriaCollection(row, criteria);\n            let ids;\n            // Get the level to add the descriptor\n            if (levelid != undefined) {\n                parentid = levelid; // compare to the id the DB gave to the level.\n            }\n\n            if (self.mode == 'edit' && levelid != undefined) { // if its come from the add descriptor we have the id of the level in the second part of the id given le\n                if (levelid.toString().indexOf('-') > -1) {\n                    parentid = levelid.slice(levelid.indexOf('-') + 1, levelid.length);\n                    ids = levelid.split('-');\n                    ids.forEach(function (id, index) {\n                        ids[index] = id.toString();\n                    }, ids);\n                }\n            }\n\n            Log.debug('parentid', parentid);\n\n            const obj = {\n                mode: self.mode,\n                parentid: parentid,\n                parentidaux: self.parentidaux,\n                ids: ids\n\n            }\n\n\n            let lvs = '';\n           \n           // lvs = criterion[0].levels;\n\n            if (criterion[0].levels.length == 0) {\n                criterion[0].levels.push({\n                    score: '',\n                    status: \"NEW\",\n                    id: parentid,\n                    descriptors: [{\n                        checked: false,\n                        descText: '',\n                        delete: 0\n                    }]\n                });\n            }\n           \n            const levelsdesc = criterion[0].levels.filter(function (level) { // User tried to save and make ready a criteria with a level with no descriptor. We are in the fix error view of the form\n                if (obj.ids != undefined) {\n                    if ((obj.ids).includes((level.id).toString())) {\n                        return level.descriptors;\n                    }\n                } else if (obj.parentid == (level.id).toString() || (obj.parentid).toString().includes((level.id).toString())) {\n                    return level.descriptors;\n                }\n\n\n            }, obj);\n            \n            \n            FeditorHelper.setCriteriaJSON(criteria);\n            FeditorHelper.setHiddenCriteriaJSON(criteria);\n            Y.log(criteria);\n            return levelsdesc;\n        }\n\n        LevelControl.prototype.getMinMaxMark = function (score) {\n\n            if (score.indexOf('-') != -1) {\n                return score.split('-');\n            } else {\n                return score.split('/');\n            }\n        }\n\n        LevelControl.prototype.setErrorMessage = function (e, message) {\n\n            e.target.classList.add('total-input-error');\n            e.target.setAttribute('data-toggle', 'tooltip');\n            e.target.setAttribute('data-placement', 'right');\n            e.target.setAttribute('data-title', message);\n        }\n\n        LevelControl.prototype.validatePreviousMarkValue = function () {\n            const self = this;\n\n            const previousLevel = document.getElementById(self.id).previousElementSibling;\n            const previousMark = previousLevel.querySelector('.fmark');\n            if (previousMark != null && previousMark.value == 0 && previousMark.value != \"\") {\n\n                previousLevel.classList.add('alert-warning');\n                previousMark.insertAdjacentHTML('afterend', '<small>Change Mark</small>');\n\n            }\n\n        }\n\n        LevelControl.prototype.cleanPreviousMarkWarning = function () {\n            const self = this;\n\n            const level = document.getElementById(self.id);\n            if (level.classList.contains('alert-warning')) {\n                level.classList.remove('alert-warning');\n                level.querySelector('.level-mark').removeChild(level.querySelector('small'));\n            }\n\n        }\n\n        LevelControl.prototype.countSelectedDescriptors = function () {\n\n        }\n\n\n\n\n\n\n        return {\n            init: init\n        };\n    });"],"file":"level_control.min.js"}