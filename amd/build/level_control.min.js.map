{"version":3,"sources":["../src/level_control.js"],"names":["define","$","Log","Str","Notification","FeditorHelper","Templates","LevelControl","level","mode","id","parentid","self","LEVEL_DESCRIPTOR_INPUT","prototype","main","debug","editModeSetupEvents","nextElementSibling","validatePreviousMarkValue","setupEvents","getAttribute","previousElementSibling","children","del","markandesc","markdesctable","querySelector","rows","each","index","row","j","td","container","classList","contains","editModeSetupEventsHelper","addEventListener","addDescriptor","bind","desciptorContainer","counter","length","descriptorIndex","lid","i","setAttribute","action","checkbox","descriptor","clickDescriptorHandler","deleteDescriptor","selectdescriptor","marktd","descriptortd","editmark","deleteLevel","e","score","target","innerHTML","focus","changeMarkHandler","add","s","cleanPreviousMarkWarning","remove","removeAttribute","el","document","getElementById","parentNode","removeChild","criteria","getCriteriaJSON","criterion","getCriterionFromCriteriaCollection","levelsdesc","getLevelDescriptors","value","error","message","previousRow","nextRow","indexOf","getMinMaxMark","min","max","parseFloat","setErrorMessage","groupid","resultRow","total","split","maxinput","totaloutof","setCriteriaJSON","preventDefault","descriptorContainer","getPreviousElement","context","getRandomID","edit","render","done","html","insertAdjacentHTML","lastChild","fail","changeDescriptorHandler","containerid","levelid","flag","Array","from","includes","slice","desc","descriptors","push","checked","descText","delete","status","d","checkboxcontainer","get_strings","key","component","strs","confirm","criTable","tr","JSON","parse","dbids","getDistanceFromCriterionHeader","dblevelid","crid","levels","dbid","stringify","deleteRow","rowIndex","editlevelhandler","textarea","changeLevelHandlerDisabled","focusoutHandlerDisabled","txtarea","levelrow","criterionheader","leveldbids","criteriaJSON","filterCriterion","filter","rowindex","lev","critlevs","definition","criterionLevel","getMode","cid","previousLevel","previousMark","countSelectedDescriptors","init","control"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n\n/**\n * @package   gradingform_frubric\n * @copyright 2021 Veronica Bermegui\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/log', 'core/str', 'core/notification', 'gradingform_frubric/feditor_helper', 'core/templates'],\n    function ($, Log, Str, Notification, FeditorHelper, Templates) {\n        'use strict';\n\n        function init(id, parentid) {\n            Log.debug('Level control...');\n            Log.debug(id);\n            const mode = FeditorHelper.getMode();\n            const level = document.getElementById(id);\n\n            let control = new LevelControl(level, mode, id, parentid);\n            control.main();\n\n        }\n\n\n        /**\n         *\n         * @param {*} level\n         * @param {*} mode\n         */\n        function LevelControl(level, mode, id, parentid) {\n            const self = this;\n            self.level = level;\n            self.mode = mode;\n            self.id = id;\n            self.parentid = parentid;\n            self.LEVEL_DESCRIPTOR_INPUT = 'gradingform_frubric/level_descriptor_input';\n        }\n\n        /**\n         * Run the controller.\n         */\n        LevelControl.prototype.main = function () {\n            let self = this;\n\n\n            if (self.mode == 'edit') {\n                Log.debug(\"self.level\");\n                Log.debug(self.level);\n                self.editModeSetupEvents(self.level.nextElementSibling);\n            } else {\n                if (self.level != null) {\n                    self.validatePreviousMarkValue() // CASE: last level  has 0 mark. A new level is added, previous level can't be zero. As 0 is only allowed for the last level,\n                    self.setupEvents(self.level);\n                }\n            }\n\n        };\n\n        LevelControl.prototype.editModeSetupEvents = function (level) {\n\n            Log.debug(\"editModeSetupEvents\");\n            const self = this;\n            Log.debug(self);\n          //  const level = self.level;//.nextElementSibling;\n            \n            Log.debug(level.getAttribute('data-row-type'));  // TODO: ADD LEVEL y ADD CRITERION\n            if (level.getAttribute('data-row-type') == 'result') {  // get the current level. Its the new level added.\n                level = self.level.previousElementSibling;\n                Log.debug(level);\n                //return;\n            }\n            self.setupEvents(level);\n            const [del, markandesc] = level.children;\n            const markdesctable = markandesc.querySelector('.level-mark-desc-table');\n            Log.debug(markdesctable);\n            let rows = markdesctable.rows;\n            $(rows).each(function(index, row){\n                \n                $(row).children().each(function (j, td){\n               \n                    $(td).children().each(function (i){\n                       \n                        const container = this;\n                        \n                        if (container.classList.contains('standard-desc-container')) {\n                            self.editModeSetupEventsHelper(container);\n                        } \n                        \n                        if (container.classList.contains('add-descriptor') ) {\n                            container.querySelector('.add-desc-btn').addEventListener('click', self.addDescriptor.bind(self));\n                        }\n\n                    });\n\n                })\n\n            });\n           \n\n        } \n\n        LevelControl.prototype.editModeSetupEventsHelper = function (desciptorContainer) {\n           var self = this;\n           Log.debug(\"editModeSetupEventsHelper\");\n           Log.debug(desciptorContainer);\n           let counter = 0;\n           counter = desciptorContainer.children.length; \n           self.descriptorIndex = counter;\n           self.parentid = desciptorContainer.children[0].getAttribute('data-parent-id');\n           self.lid = desciptorContainer.children[0].getAttribute('id');\n\n            $(desciptorContainer).each(function (i, td){\n                $(td).children().each(function (i){\n                       \n                    const container = this;\n                    Log.debug(container)\n                  \n                    if (container.classList.contains('fmark')) {\n                        return;\n                    }\n\n                    container.setAttribute('descriptor-index', i);\n\n                    const action = container.querySelector('.action-el');\n                    const checkbox = container.querySelector('.standard-check');\n                    const descriptor = container.querySelector('.standard-desc');\n\n                    descriptor.addEventListener('click', self.clickDescriptorHandler.bind(this, self));\n                    action.addEventListener('click', self.deleteDescriptor.bind(self, descriptor, container));\n                    checkbox.addEventListener('click', self.selectdescriptor.bind(this, self));\n\n                });\n            });\n        }\n\n        LevelControl.prototype.setupEvents = function (level) {\n            let self = this;\n            Log.debug(\"Level control: setupEvents\");\n            Log.debug(level);\n            const [del, markandesc] = level.children;\n            Log.debug(markandesc);\n            const markdesctable = markandesc.querySelector('.level-mark-desc-table');\n            Log.debug(markdesctable);\n            const [marktd, descriptortd] = markdesctable.rows[0].children;\n\n            marktd.querySelector('.level-mark > textarea').addEventListener('click', self.editmark.bind(self));\n            \n            if (self.mode != 'edit') {\n                descriptortd.querySelector('.add-desc-btn').addEventListener('click', self.addDescriptor.bind(self));\n            }\n            del.addEventListener('click', self.deleteLevel.bind(self));\n\n        };\n\n        LevelControl.prototype.editmark = function (e) {\n            Log.debug(\"editmark...\");\n            const self = this;\n            const score = e.target;\n\n            if (score.innerHTML == '[Min - Max]') {\n                score.innerHTML = '';\n            }\n\n            score.focus();\n\n            if (!score.classList.contains('changeh')) {\n                score.addEventListener('change', self.changeMarkHandler.bind(this, self));\n                score.classList.add('changeh');\n            }\n\n\n        }\n\n        LevelControl.prototype.changeMarkHandler = function (s, e) {\n            Log.debug(\"changeMarkHandler\");\n            \n            // If it came from validatePreviousMarkValue we need to remove the class warning\n            s.cleanPreviousMarkWarning();\n            // Remove error message if the user inserted wrong data before.\n            e.target.classList.remove('total-input-error');\n            e.target.removeAttribute('data-toggle');\n            e.target.removeAttribute('data-placement');\n            e.target.removeAttribute('data-title');\n\n\n            const el = document.getElementById(e.target.getAttribute('aria-describedby'));\n\n            if (el != null) {\n                el.parentNode.removeChild(el);\n                e.target.removeAttribute('data-original-title');\n                e.target.removeAttribute('title');\n                e.target.removeAttribute('aria-describedby');\n\n            }\n\n            // Update the score for this criterion.\n            const criteria = FeditorHelper.getCriteriaJSON();\n            const criterion = FeditorHelper.getCriterionFromCriteriaCollection(document.getElementById(s.id), criteria);\n            const levelsdesc = s.getLevelDescriptors(s.id, criteria);\n            const score = e.target.value;\n\n            let error = false;\n            let message = '';\n            Log.debug(\"SCORE\");\n            Log.debug(score);\n            // First check if its 0. This value is valid in the last row. Meaning the student didnt reach the min. standard\n            if (score == 0) {\n\n                // Only the last row can score 0.\n                // Check its the last by checking the next sibling => it has to be the result row.\n                // Check prevoious sibling => It has to be a leevl row\n                const previousRow = (document.getElementById(s.id).previousElementSibling).getAttribute('data-row-type');\n                const nextRow = (document.getElementById(s.id).nextElementSibling).getAttribute('data-row-type');\n\n                if (!(previousRow == 'level' && nextRow == 'result')) {\n                    error = true;\n                    message = 'Zero mark only allowed in last level'\n                }\n\n            } else {\n\n                if (score.indexOf('-') == -1 && score.indexOf('/') == -1) {\n                    error = true;\n                    message = 'Invalid value. Accepts min-max or min/max';\n                } else {\n                    // Evaluate min/max \n                    var [min, max] = s.getMinMaxMark(score);\n                    Log.debug(\"min-max\");\n                    Log.debug(min);\n                    Log.debug(max);\n                    if (min.length == 0 || max.length == 0) {\n                        error = true;\n                    } else if ((min.length > 0 && max.length > 0) && (parseFloat(min) > parseFloat(max))) {\n                        error = true;\n                        message = 'Min value is greater than max value';\n                    }\n\n                }\n            }\n\n            if (error) {\n                s.setErrorMessage(e, message);\n                error = false;\n                return;\n            }\n\n\n            // Update the total result input. with the highest value.\n            const groupid = document.getElementById(s.parentid).getAttribute('data-criterion-group');\n            const resultRow = document.querySelector(`[data-criterion-group=\"${groupid}\"][data-row-type=\"result\"]`);\n            var total = (resultRow.querySelector(`#out-of-value-${groupid}`).innerHTML).split(\"/\");\n            const maxinput = resultRow.querySelector('.total-input');\n           \n            levelsdesc[0].score = e.target.value;\n            total = total[total.length - 1];\n\n            if (total === \"\") { //  Its the first value available.\n                resultRow.querySelector(`#out-of-value-${groupid}`).innerHTML = `/${max}`;\n                total = max;\n\n            } else { // check if the max we have has to be replaced by a new max\n\n                if (parseFloat(total) < max) {\n                    total = max;\n                    resultRow.querySelector(`#out-of-value-${groupid}`).innerHTML = `/${max}`;\n                }\n            }\n\n            // Update the max attribute.\n            maxinput.setAttribute(\"max\", total);\n            criterion[0].totaloutof = total;\n\n            FeditorHelper.setCriteriaJSON(criteria);\n\n\n        }\n\n        LevelControl.prototype.addDescriptor = function (e) {\n            \n            const self = this;\n\n            e.preventDefault();\n            // Get the standard-desc-container  that contains the descritors.\n            const descriptorContainer = FeditorHelper.getPreviousElement(e.target.parentNode, '.standard-desc-container');\n\n            const context = {\n                id: self.mode != 'edit' ? `${self.id}-${FeditorHelper.getRandomID()}` : `${self.id}-${descriptorContainer.children[0].getAttribute('id')}`,\n                parentid: self.parentid,\n                edit: self.mode == 'edit',\n                index: descriptorContainer.children.length,\n            };\n\n            if (self.mode != 'edit') {\n                delete context.index;\n            }\n\n            Log.debug(\"CONTEXT\");\n            Log.debug(context);\n\n            Templates.render(self.LEVEL_DESCRIPTOR_INPUT, context)\n                .done(function (html, js) {\n                    descriptorContainer.insertAdjacentHTML('beforeend', html);\n                    const container = descriptorContainer.lastChild;\n                    const action = container.querySelector('.action-el');\n                    const checkbox = container.querySelector('.standard-check');\n                    const descriptor = container.querySelector('.standard-desc');\n                    descriptor.addEventListener('click', self.clickDescriptorHandler.bind(this, self));\n                    action.addEventListener('click', self.deleteDescriptor.bind(self, descriptorContainer, container));\n                    checkbox.addEventListener('click', self.selectdescriptor.bind(this, self));\n\n                })\n                .fail(function (ex) {\n                    Log.debug(\"error...\");\n                });\n\n        }\n\n\n        LevelControl.prototype.clickDescriptorHandler = function (s, e) {\n            Log.debug('clickDescriptorHandler...');\n            let descriptor = e.target;\n\n            if (descriptor.innerHTML == 'Click to edit level descriptor') {\n                descriptor.innerHTML = '';\n            }\n\n            descriptor.focus();\n\n            // Attach change event\n            descriptor.addEventListener('change', s.changeDescriptorHandler.bind(this, s));\n\n        }\n\n        LevelControl.prototype.changeDescriptorHandler = function (e, s) {\n            Log.debug(\"changeDescriptorHandler\");\n           \n            const criteria = FeditorHelper.getCriteriaJSON();\n            const containerid = s.target.getAttribute('data-container-id');\n            let levelid;\n            let flag = false;\n\n            Log.debug(criteria);\n            let descriptorIndex = s.target.parentNode.getAttribute('descriptor-index');\n\n            if (descriptorIndex != null) {\n                levelid = s.target.parentNode.getAttribute('id');\n            } else {\n                descriptorIndex = Array.from(document.getElementById(containerid).parentNode.children).indexOf(s.target.parentNode)\n            }\n\n            if (levelid != undefined && levelid.includes(\"-\")) { // We are adding a descriptor to a level that is already in the DB.\n                levelid.slice(levelid.indexOf('-') + 1, levelid.length) ;\n                flag = true;\n\n            }\n            Log.debug(levelid);\n            const levelsdesc = e.getLevelDescriptors(e.id, criteria, levelid);\n            const desc = levelsdesc[0].descriptors[descriptorIndex];\n          \n            Log.debug(desc);\n\n            if (desc == undefined) { // New entry\n\n                levelsdesc[0].descriptors.push({\n                    checked: false,\n                    descText: s.target.value,\n                    delete: 0\n                });\n\n                if (flag) {  // A descriptor has been added to a level that is already in the DB.\n                    levelsdesc[0].status = 'UPDATE';\n                }\n\n            } else { // Existing entry, update text.\n                desc.descText = s.target.value;\n\n       \n                if (levelsdesc[0].status == 'CREATED') {\n                    levelsdesc[0].status = 'UPDATE';\n                }\n            }\n\n            Log.debug(levelsdesc[0].descriptors);\n\n            FeditorHelper.setCriteriaJSON(criteria);\n\n        }\n\n        LevelControl.prototype.selectdescriptor = function (e, s) {\n\n           \n            Log.debug(\"selectdescriptor\");\n            Log.debug(e);\n            Log.debug(s);\n            const containerid = s.target.getAttribute('data-container-id');\n            const criteria = FeditorHelper.getCriteriaJSON();\n            let levelsdesc;\n            let descriptorIndex = s.target.parentNode.getAttribute('descriptor-index'); \n\n            if (descriptorIndex != null) {\n                const levelid = s.target.parentNode.getAttribute('id');\n                levelsdesc = e.getLevelDescriptors(e.id, criteria, levelid);\n            } else {\n                descriptorIndex = Array.from(document.getElementById(containerid).parentNode.children).indexOf(s.target.parentNode);\n                levelsdesc = e.getLevelDescriptors(e.id, criteria);\n            }\n            Log.debug(levelsdesc);\n\n            const d = levelsdesc[0].descriptors[descriptorIndex];\n            d.checked = s.target.checked;\n\n            // check if its already in teh DB, if so, change the status\n            if (levelsdesc[0].status == 'CREATED' || levelsdesc[0].status == 'UPDATED') {\n                levelsdesc[0].status = 'UPDATE';\n            }\n            // Update the input.\n            FeditorHelper.setCriteriaJSON(criteria);\n        }\n\n        LevelControl.prototype.deleteDescriptor = function (descriptorContainer, checkboxcontainer) {\n            Log.debug('deleteDescriptor');\n            Log.debug(descriptorContainer);\n            Log.debug(checkboxcontainer);\n            var self = this;\n\n            Log.debug(self);\n\n            if (checkboxcontainer.getAttribute('descriptor-index')) { // This means the descriptor is already saved in the BD. ask if theya re sure to remove\n\n                Str.get_strings([{\n                        key: 'confirm',\n                        component: 'gradingform_frubric'\n                    },\n                    {\n                        key: 'confirmdeletedescriptor',\n                        component: 'gradingform_frubric'\n                    },\n                    {\n                        key: 'yes'\n                    },\n                    {\n                        key: 'no'\n                    },\n\n                ]).done(function (strs) {\n                    Notification.confirm(strs[0], strs[1], strs[2], strs[3], function () {\n                        Log.debug(\"Notification...\");\n                      \n                        const criteria = FeditorHelper.getCriteriaJSON();\n                        const levelid = checkboxcontainer.getAttribute('id');\n                        const parentid = self.id;\n                        const descriptorIndex = checkboxcontainer.getAttribute('descriptor-index'); \n                        const levelsdesc = self.getLevelDescriptors(parentid, criteria, levelid);\n                        const d = levelsdesc[0].descriptors[descriptorIndex];\n                        d.delete = 1;\n                        levelsdesc[0].status = 'UPDATE';\n                      \n                        // Update the input.\n                        FeditorHelper.setCriteriaJSON(criteria);\n\n                        //descriptorContainer.removeChild(checkboxcontainer);\n                      //  checkboxcontainer.removeChild(descriptorContainer);\n                      checkboxcontainer.remove();\n\n\n                    }, function () {\n                        // For the cancel btn.\n                        return;\n                    });\n                });\n\n            } else {\n                descriptorContainer.removeChild(checkboxcontainer);\n                // TODO: UPDATE JSON\n            }\n        }\n\n        LevelControl.prototype.deleteLevel = function (e) {\n            Log.debug('deleteLevel');\n            Log.debug(e);\n\n            Str.get_strings([{\n                    key: 'confirm',\n                    component: 'gradingform_frubric'\n                },\n                {\n                    key: 'confirmdeletelevel',\n                    component: 'gradingform_frubric'\n                },\n                {\n                    key: 'yes'\n                },\n                {\n                    key: 'no'\n                },\n\n            ]).done(function (strs) {\n                Notification.confirm(strs[0], strs[1], strs[2], strs[3], function () {\n                    let criTable = document.getElementById('criteriaTable');\n                    const tr = e.target.parentNode.parentNode.parentNode;\n                    const criterion = FeditorHelper.getPreviousElement(tr, '.criterion-header');\n                    let criteria = JSON.parse(document.getElementById('id_criteria').value);\n\n                    if (criterion.getAttribute('data-criterion-levels').length > 0) {\n\n                        const dbids = JSON.parse(criterion.getAttribute('data-criterion-levels')); // These are the ids of the levels given by the DB.\n                        const index = FeditorHelper.getDistanceFromCriterionHeader(tr, '.criterion-header');\n                        const dblevelid = dbids[index];\n                        const crid = tr.getAttribute('data-criterion-group')\n\n                        var levels;\n                        for (let i = 0; i < criteria.length; i++) {\n                            if (criteria[i].id == crid) {\n                                criteria[i].status = 'UPDATE';\n                                levels = criteria[i].levels;\n                                break;\n                            }\n                        }\n\n                        for (let j = 0; j < levels.length; j++) {\n                            if (levels[j].dbid == dblevelid) {\n                                levels[j].status = 'DELETE';\n                                break;\n                            }\n                        }\n\n                    }\n\n\n                    document.getElementById('id_criteria').value = JSON.stringify(criteria);\n                    criTable.deleteRow(tr.rowIndex); // span -> td -> tr.\n\n                }, function () {\n                    // For the cancel btn.\n                    return;\n                });\n            });\n        };\n\n        LevelControl.prototype.editlevelhandler = function (e) {\n            Log.debug('editlevelhandler');\n            Log.debug(e);\n            Log.debug(this);\n            let textarea = e.target;\n\n            if (textarea.innerHTML == 'Click to edit Level description' || textarea.innerHTML == 'Click to edit Mark') {\n                textarea.innerHTML = '';\n            }\n\n            textarea.removeAttribute('disabled');\n            textarea.focus();\n            textarea.addEventListener('change', this.changeLevelHandlerDisabled.bind(this, textarea));\n            textarea.addEventListener('focusout', this.focusoutHandlerDisabled);\n        };\n\n        LevelControl.prototype.changeLevelHandlerDisabled = function (txtarea, e) {\n            Log.debug('changeLevelHandlerDisabled');\n\n            let id = e.target.parentNode.parentNode.parentNode.getAttribute('data-criterion-group');\n            const levelrow = e.target.parentNode.parentNode.parentNode;\n            // Get the criterion row this level belongs to\n            const criterionheader = FeditorHelper.getPreviousElement(levelrow, '.criterion-header');\n            let leveldbids = criterionheader.getAttribute('data-criterion-levels').length > 0 ? JSON.parse(criterionheader.getAttribute('data-criterion-levels')) : []; // Get the dbids\n\n            const criteriaJSON = FeditorHelper.getCriteriaJSON();\n            const rowIndex = e.target.parentNode.parentNode.parentNode.rowIndex;\n\n            let levelid = id + '_' + rowIndex;\n\n            if (leveldbids.length > 0) {\n                levelid = (leveldbids[rowIndex - 1] != undefined) ? `${id}_${leveldbids[rowIndex - 1]}` : levelid; // The criterion already exists but this is a new level, not saved in the DB yet.\n            }\n\n            const filterCriterion = criteriaJSON.filter(function (criterion, index) {\n                const id = e.target.parentNode.parentNode.parentNode.getAttribute('data-criterion-group');\n                criterion.rowindex = index;\n                if (id == criterion.id) {\n                    return criterion;\n                }\n            }, e);\n\n            // Find the level and update the values\n            if (filterCriterion[0].levels != undefined) {\n                var lev = null;\n                const critlevs = filterCriterion[0].levels;\n\n                for (let i = 0; i < critlevs.length; i++) {\n\n                    if ((critlevs[i]).id != levelid) {\n                        continue;\n                    } else {\n                        lev = critlevs[i];\n                        break;\n\n                    }\n                }\n\n                if (lev != null) {\n                    if (e.target.classList.contains('mark_txtarea')) {\n                        lev.score = e.target.value;\n                    } else {\n                        lev.definition = e.target.value;\n                    }\n                    if (lev.status == 'CREATED' || lev.status == 'UPDATED') { // It was updated before. \n                        lev.status = 'UPDATE';\n                    }\n\n                } else {\n\n                    let criterionLevel = {\n                        id: levelid,\n                        status: 'NEW',\n                        score: '',\n                        definition: ''\n                    };\n\n                    if (e.target.classList.contains('mark_txtarea')) {\n                        criterionLevel.score = e.target.value;\n                    } else {\n                        criterionLevel.definition = e.target.value;\n                    }\n                    (filterCriterion[0]).levels.push(criterionLevel);\n                }\n\n                if (FeditorHelper.getMode() == 'edit') {\n\n                    if (filterCriterion[0].cid.includes(\"NEWID\") != true) { // A new criterion added\n                        filterCriterion[0].status = \"UPDATE\"; // The criterion was updated because it has new levels.\n                    } else {\n                        filterCriterion[0].status = \"NEW\";\n                    }\n                }\n\n            }\n\n            document.getElementById('id_criteria').value = JSON.stringify(criteriaJSON); // Criterionjson;\n\n\n            e.target.setAttribute('disabled', true);\n        };\n\n        LevelControl.prototype.focusoutHandlerDisabled = function (e) {\n            Log.debug('focusoutHandlerDisabled');\n            e.target.setAttribute('disabled', true);\n        };\n\n        LevelControl.prototype.getLevelDescriptors = function (parentid, criteria, levelid) {\n            var self = this;\n            Log.debug(\"getLevelDescriptors...\");\n            Log.debug(self);\n            const row = document.getElementById(parentid);\n\n            Log.debug(row);\n            Log.debug(parentid);\n            \n            const criterion = FeditorHelper.getCriterionFromCriteriaCollection(row, criteria);\n            Log.debug(criterion);\n            Log.debug(levelid);\n            // Get the level to add the descriptor\n            if (levelid != undefined ) {\n                parentid = levelid; // compare to the id the DB gave to the level.\n            }\n           \n            if(self.mode == 'edit') { // if its come from the add descriptor we have the id of the level in the second part of the id given le\n                parentid = levelid.slice(levelid.indexOf('-') + 1, levelid.length) ;\n            }\n\n            const levelsdesc = criterion[0].levels.filter(function (level, index) {\n                if (parentid == level.id) {\n                    return level.descriptors;\n                }\n            }, parentid);\n\n            return levelsdesc;\n        }\n\n        LevelControl.prototype.getMinMaxMark = function (score) {\n\n            if (score.indexOf('-') != -1) {\n                return score.split('-');\n            } else {\n                return score.split('/');\n            }\n        }\n\n        LevelControl.prototype.setErrorMessage = function (e, message) {\n            Log.debug(message);\n\n\n            e.target.classList.add('total-input-error');\n            e.target.setAttribute('data-toggle', 'tooltip');\n            e.target.setAttribute('data-placement', 'right');\n            e.target.setAttribute('data-title', message);\n        }\n\n        LevelControl.prototype.validatePreviousMarkValue = function () {\n            const self = this;\n\n            const previousLevel = document.getElementById(self.id).previousElementSibling;\n            const previousMark = previousLevel.querySelector('.fmark');\n            Log.debug(\"previousMark\");\n            if (previousMark != null && previousMark.value == 0 && previousMark.value != \"\") {\n                Log.debug(previousMark.value);\n\n                previousLevel.classList.add('alert-warning');\n                previousMark.insertAdjacentHTML('afterend', '<small>Change Mark</small>');\n\n            }\n\n        }\n\n        LevelControl.prototype.cleanPreviousMarkWarning = function () {\n            const self = this;\n\n            const level = document.getElementById(self.id);\n            if (level.classList.contains('alert-warning')) {\n                level.classList.remove('alert-warning');\n                level.querySelector('.level-mark').removeChild(level.querySelector('small'));\n            }\n\n        }\n\n        LevelControl.prototype.countSelectedDescriptors = function () {\n\n        }\n\n\n\n\n\n\n        return {\n            init: init\n        };\n    });"],"file":"level_control.min.js"}