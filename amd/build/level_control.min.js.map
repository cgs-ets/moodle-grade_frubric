{"version":3,"sources":["../src/level_control.js"],"names":["define","$","Log","Str","Notification","FeditorHelper","Templates","LevelControl","level","mode","id","parentid","self","LEVEL_DESCRIPTOR_INPUT","prototype","main","validatePreviousMarkValue","setupEvents","debug","children","del","markandesc","markdesctable","querySelector","rows","marktd","descriptortd","addEventListener","editmark","bind","addDescriptor","deleteLevel","e","score","target","innerHTML","focus","classList","contains","changeMarkHandler","add","s","cleanPreviousMarkWarning","remove","removeAttribute","el","document","getElementById","getAttribute","parentNode","removeChild","criteria","getCriteriaJSON","criterion","getCriterionFromCriteriaCollection","levelsdesc","getLevelDescriptors","value","error","message","previousRow","previousElementSibling","nextRow","nextElementSibling","indexOf","getMinMaxMark","min","max","length","parseFloat","setErrorMessage","groupid","resultRow","total","split","maxinput","setAttribute","totaloutof","setCriteriaJSON","preventDefault","descriptorContainer","getPreviousElement","context","getRandomID","render","done","html","insertAdjacentHTML","container","lastChild","action","checkbox","descriptor","clickDescriptorHandler","deleteDescriptor","selectdescriptor","fail","changeDescriptorHandler","descriptors","push","checked","descText","delete","containerid","descriptorIndex","Array","from","d","checkboxcontainer","get_strings","key","component","strs","confirm","criTable","tr","JSON","parse","dbids","index","getDistanceFromCriterionHeader","dblevelid","crid","levels","i","status","j","dbid","stringify","deleteRow","rowIndex","editlevelhandler","textarea","changeLevelHandlerDisabled","focusoutHandlerDisabled","txtarea","levelrow","criterionheader","leveldbids","criteriaJSON","levelid","filterCriterion","filter","rowindex","lev","critlevs","definition","criterionLevel","getMode","cid","includes","updateLevelObject","row","previousLevel","previousMark","init","control"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n\n/**\n * @package   gradingform_frubric\n * @copyright 2021 Veronica Bermegui\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/log', 'core/str', 'core/notification', 'gradingform_frubric/feditor_helper', 'core/templates'],\n  function ($, Log, Str, Notification, FeditorHelper, Templates) {\n    'use strict';\n\n    function init(id, parentid) {\n      Log.debug('Level control...');\n      Log.debug(id);\n      const mode = FeditorHelper.getMode();\n      const level = document.getElementById(id);\n\n      let control = new LevelControl(level, mode, id, parentid);\n      control.main();\n\n    }\n\n\n    /**\n     *\n     * @param {*} level\n     * @param {*} mode\n     */\n    function LevelControl(level, mode, id, parentid) {\n      const self = this;\n      self.level = level;\n      self.mode = mode;\n      self.id = id;\n      self.parentid = parentid;\n      self.LEVEL_DESCRIPTOR_INPUT = 'gradingform_frubric/level_descriptor_input';\n    }\n\n    /**\n     * Run the controller.\n     */\n    LevelControl.prototype.main = function () {\n      let self = this;\n\n\n      if (self.level != null) {\n        self.validatePreviousMarkValue() // CASE: last level  has 0 mark. A new level is added, previous level can't be zero. As 0 is only allowed for the last level,\n        self.setupEvents(self.level);\n      }\n\n    };\n\n    LevelControl.prototype.setupEvents = function (level) {\n      let self = this;\n      Log.debug(\"Level control: setupEvents\");\n\n      const [del, markandesc] = level.children;\n      const markdesctable = markandesc.querySelector('.level-mark-desc-table');\n      const [marktd, descriptortd] = markdesctable.rows[0].children;\n      marktd.querySelector('.level-mark > textarea').addEventListener('click', self.editmark.bind(self));\n      descriptortd.querySelector('.add-desc-btn').addEventListener('click', self.addDescriptor.bind(self));\n      del.addEventListener('click', self.deleteLevel.bind(self));\n\n    };\n\n    LevelControl.prototype.editmark = function (e) {\n      const self = this;\n      const score = e.target;\n\n      if (score.innerHTML == '[Min - Max]') {\n        score.innerHTML = '';\n      }\n      \n      score.focus();\n\n      if (!score.classList.contains('changeh')) {\n        score.addEventListener('change', self.changeMarkHandler.bind(this, self));\n        score.classList.add('changeh');\n      }\n      \n\n    }\n\n    LevelControl.prototype.changeMarkHandler = function (s, e) {\n      Log.debug(\"changeMarkHandler\");\n\n      // If it came from validatePreviousMarkValue we need to remove the class warning\n      s.cleanPreviousMarkWarning();\n      // Remove error message if the user inserted wrong data before.\n      e.target.classList.remove('total-input-error');\n      e.target.removeAttribute('data-toggle');\n      e.target.removeAttribute('data-placement');\n      e.target.removeAttribute('data-title');\n\n\n      const el = document.getElementById(e.target.getAttribute('aria-describedby'));\n\n      if (el != null) {\n        el.parentNode.removeChild(el);\n        e.target.removeAttribute('data-original-title');\n        e.target.removeAttribute('title');\n        e.target.removeAttribute('aria-describedby');\n\n      }\n\n      // Update the score for this criterion.\n      const criteria = FeditorHelper.getCriteriaJSON();\n      const criterion = FeditorHelper.getCriterionFromCriteriaCollection(document.getElementById(s.id), criteria);\n      const levelsdesc = s.getLevelDescriptors(s.id, criteria);\n      const score = e.target.value;\n    \n      let error = false;\n      let message = '';\n     \n      // First check if its 0. This value is valid in the last row. Meaning the student didnt reach the min. standard\n      if (score == 0) {\n\n        // Only the last row can score 0.\n        // Check its the last by checking the next sibling => it has to be the result row.\n        // Check prevoious sibling => It has to be a leevl row\n        const previousRow = (document.getElementById(s.id).previousElementSibling).getAttribute('data-row-type');\n        const nextRow = (document.getElementById(s.id).nextElementSibling).getAttribute('data-row-type');\n\n        if (!(previousRow == 'level' && nextRow == 'result')) {\n          error = true;\n          message = 'Zero mark only allowed in last level'\n        }\n\n      } else {\n\n        if (score.indexOf('-') == -1 && score.indexOf('/') == -1) {\n          error = true;\n          message = 'Invalid value. Accepts min-max or min/max';\n        } else {\n          // Evaluate min/max \n          var [min, max] = s.getMinMaxMark(score);\n          \n          if (min.length == 0 || max.length == 0) {\n            error = true;\n          } else if ((min.length > 0 && max.length > 0) && (parseFloat(min) > parseFloat(max))) {\n            error = true;\n            message = 'Min value is greater than max value';\n          }\n\n        }\n      }\n    \n      if (error) {\n        s.setErrorMessage(e, message);\n        error = false;\n        return;\n      }\n      \n      // Update the total result input. with the highest value.\n      const groupid = document.getElementById(s.parentid).getAttribute('data-criterion-group');\n      const resultRow = document.querySelector(`[data-criterion-group=\"${groupid}\"][data-row-type=\"result\"]`);\n      var total = (resultRow.querySelector(\"#out-of-value-1\").innerHTML).split(\"/\");\n      const maxinput = resultRow.querySelector('.total-input');\n    \n      levelsdesc[0].score = e.target.value;\n      total = total[total.length -1];\n     \n      if (total == \"-\") { //  Its the first value available.\n        resultRow.querySelector(`#out-of-value-${groupid}`).innerHTML = `/${max}`;\n        total = max;\n\n      }  else { // check if the max we have has to be replaced by a new max\n\n          if (parseFloat(total) < max ) {\n            total = max;\n            resultRow.querySelector(`#out-of-value-${groupid}`).innerHTML = `/${max}`;\n          }\n      }\n\n       // Update the max attribute.\n      maxinput.setAttribute(\"max\", total);\n      criterion[0].totaloutof = total;\n\n      FeditorHelper.setCriteriaJSON(criteria);\n\n\n    }\n\n    LevelControl.prototype.addDescriptor = function (e) {\n      const self = this;\n\n      e.preventDefault();\n\n      // Get the standard-desc-container  that contains the descritors \n      const descriptorContainer = FeditorHelper.getPreviousElement(e.target.parentNode, '.standard-desc-container');\n\n      const context = {\n        id: `${self.id}-${FeditorHelper.getRandomID()}`,\n        parentid: self.parentid,\n      };\n\n      Templates.render(self.LEVEL_DESCRIPTOR_INPUT, context)\n        .done(function (html, js) {\n          descriptorContainer.insertAdjacentHTML('beforeend', html);\n          const container = descriptorContainer.lastChild;\n          const action = container.querySelector('.action-el');\n          const checkbox = container.querySelector('.standard-check');\n          const descriptor = container.querySelector('.standard-desc');\n          descriptor.addEventListener('click', self.clickDescriptorHandler.bind(this, self));\n          action.addEventListener('click', self.deleteDescriptor.bind(this, descriptorContainer, container));\n          checkbox.addEventListener('click', self.selectdescriptor.bind(this, self));\n\n        })\n        .fail(function (ex) {\n          Log.debug(\"error...\");\n        });\n\n    }\n\n\n    LevelControl.prototype.clickDescriptorHandler = function (s, e) {\n      Log.debug('clickDescriptorHandler...');\n      let descriptor = e.target;\n\n      if (descriptor.innerHTML == 'Click to edit level descriptor') {\n        descriptor.innerHTML = '';\n      }\n\n      descriptor.focus();\n\n      // Attach change event\n      descriptor.addEventListener('change', s.changeDescriptorHandler.bind(this, s));\n\n    }\n\n    LevelControl.prototype.changeDescriptorHandler = function (e, s) {\n      Log.debug(\"changeDescriptorHandler\");\n\n      const criteria = FeditorHelper.getCriteriaJSON();\n      const levelsdesc = e.getLevelDescriptors(e.id, criteria)\n\n      Log.debug(levelsdesc);\n\n      levelsdesc[0].descriptors.push({\n\n        checked: false,\n        descText: s.target.value,\n        delete: 0\n      });\n\n\n      FeditorHelper.setCriteriaJSON(criteria);\n\n    }\n\n    LevelControl.prototype.selectdescriptor = function (s, e) {\n      Log.debug(\"selectdescriptor\");\n      const containerid = e.target.getAttribute('data-container-id');\n      const descriptorIndex = Array.from(document.getElementById(containerid).parentNode.children).indexOf(e.target.parentNode); // Get the index of the element to match with the descriptor\n      const criteria = FeditorHelper.getCriteriaJSON();\n      const levelsdesc = s.getLevelDescriptors(s.id, criteria);\n\n      Log.debug(levelsdesc);\n\n      const d = levelsdesc[0].descriptors[descriptorIndex];\n      d.checked = e.target.checked;\n      // Update the input.\n      FeditorHelper.setCriteriaJSON(criteria);\n    }\n\n    LevelControl.prototype.deleteDescriptor = function (descriptorContainer, checkboxcontainer) {\n      Log.debug('deleteDescriptor');\n      Log.debug(checkboxcontainer);\n      Log.debug(descriptorContainer);\n      descriptorContainer.removeChild(checkboxcontainer);\n      //TODO: update the json.\n    }\n\n    LevelControl.prototype.deleteLevel = function (e) {\n      Log.debug('deleteLevel');\n      Log.debug(e);\n\n      Str.get_strings([{\n          key: 'confirm',\n          component: 'gradingform_frubric'\n        },\n        {\n          key: 'confirmdeletelevel',\n          component: 'gradingform_frubric'\n        },\n        {\n          key: 'yes'\n        },\n        {\n          key: 'no'\n        },\n\n      ]).done(function (strs) {\n        Notification.confirm(strs[0], strs[1], strs[2], strs[3], function () {\n          let criTable = document.getElementById('criteriaTable');\n          const tr = e.target.parentNode.parentNode.parentNode;\n          const criterion = FeditorHelper.getPreviousElement(tr, '.criterion-header');\n          let criteria = JSON.parse(document.getElementById('id_criteria').value);\n\n          if (criterion.getAttribute('data-criterion-levels').length > 0) {\n\n            const dbids = JSON.parse(criterion.getAttribute('data-criterion-levels')); // These are the ids of the levels given by the DB.\n            const index = FeditorHelper.getDistanceFromCriterionHeader(tr, '.criterion-header');\n            const dblevelid = dbids[index];\n            const crid = tr.getAttribute('data-criterion-group')\n\n            var levels;\n            for (let i = 0; i < criteria.length; i++) {\n              if (criteria[i].id == crid) {\n                Log.debug(\"en el if\");\n                criteria[i].status = 'UPDATE';\n                levels = criteria[i].levels;\n                break;\n              }\n            }\n\n            for (let j = 0; j < levels.length; j++) {\n              if (levels[j].dbid == dblevelid) {\n                levels[j].status = 'DELETE';\n                break;\n              }\n            }\n\n          }\n\n\n          document.getElementById('id_criteria').value = JSON.stringify(criteria);\n          criTable.deleteRow(tr.rowIndex); // span -> td -> tr.\n\n        }, function () {\n          // For the cancel btn.\n          return;\n        });\n      });\n    };\n\n    LevelControl.prototype.editlevelhandler = function (e) {\n      Log.debug('editlevelhandler');\n      Log.debug(e);\n      Log.debug(this);\n      let textarea = e.target;\n\n      if (textarea.innerHTML == 'Click to edit Level description' || textarea.innerHTML == 'Click to edit Mark') {\n        textarea.innerHTML = '';\n      }\n\n      textarea.removeAttribute('disabled');\n      textarea.focus();\n      textarea.addEventListener('change', this.changeLevelHandlerDisabled.bind(this, textarea));\n      textarea.addEventListener('focusout', this.focusoutHandlerDisabled);\n    };\n\n    LevelControl.prototype.changeLevelHandlerDisabled = function (txtarea, e) {\n      Log.debug('changeLevelHandlerDisabled');\n\n      let id = e.target.parentNode.parentNode.parentNode.getAttribute('data-criterion-group');\n      const levelrow = e.target.parentNode.parentNode.parentNode;\n      // Get the criterion row this level belongs to\n      const criterionheader = FeditorHelper.getPreviousElement(levelrow, '.criterion-header');\n      let leveldbids = criterionheader.getAttribute('data-criterion-levels').length > 0 ? JSON.parse(criterionheader.getAttribute('data-criterion-levels')) : []; // Get the dbids\n\n      const criteriaJSON = FeditorHelper.getCriteriaJSON();\n      const rowIndex = e.target.parentNode.parentNode.parentNode.rowIndex;\n\n      let levelid = id + '_' + rowIndex;\n\n      if (leveldbids.length > 0) {\n        levelid = (leveldbids[rowIndex - 1] != undefined) ? `${id}_${leveldbids[rowIndex - 1]}` : levelid; // The criterion already exists but this is a new level, not saved in the DB yet.\n      }\n\n      const filterCriterion = criteriaJSON.filter(function (criterion, index) {\n        const id = e.target.parentNode.parentNode.parentNode.getAttribute('data-criterion-group');\n        criterion.rowindex = index;\n        if (id == criterion.id) {\n          return criterion;\n        }\n      }, e);\n\n      // Find the level and update the values\n      if (filterCriterion[0].levels != undefined) {\n        var lev = null;\n        const critlevs = filterCriterion[0].levels;\n\n        for (let i = 0; i < critlevs.length; i++) {\n\n          if ((critlevs[i]).id != levelid) {\n            continue;\n          } else {\n            lev = critlevs[i];\n            break;\n\n          }\n        }\n\n        if (lev != null) {\n          if (e.target.classList.contains('mark_txtarea')) {\n            lev.score = e.target.value;\n          } else {\n            lev.definition = e.target.value;\n          }\n          if (lev.status == 'CREATED' || lev.status == 'UPDATED') { // It was updated before. \n            lev.status = 'UPDATE';\n          }\n\n        } else {\n\n          let criterionLevel = {\n            id: levelid,\n            status: 'NEW',\n            score: '',\n            definition: ''\n          };\n\n          if (e.target.classList.contains('mark_txtarea')) {\n            criterionLevel.score = e.target.value;\n          } else {\n            criterionLevel.definition = e.target.value;\n          }\n          (filterCriterion[0]).levels.push(criterionLevel);\n        }\n\n        if (FeditorHelper.getMode() == 'edit') {\n\n          if (filterCriterion[0].cid.includes(\"NEWID\") != true) { // A new criterion added\n            filterCriterion[0].status = \"UPDATE\"; // The criterion was updated because it has new levels.\n          } else {\n            filterCriterion[0].status = \"NEW\";\n          }\n        }\n\n      }\n\n      document.getElementById('id_criteria').value = JSON.stringify(criteriaJSON); // Criterionjson;\n\n\n      e.target.setAttribute('disabled', true);\n    };\n\n    LevelControl.prototype.focusoutHandlerDisabled = function (e) {\n      Log.debug('focusoutHandlerDisabled');\n      e.target.setAttribute('disabled', true);\n    };\n\n    LevelControl.prototype.updateLevelObject = function () {\n\n      let criteria = FeditorHelper.getCriteriaJSON();\n\n      //Get the criterion\n      const filterCriterion = FeditorHelper.getCriterionFromCriteriaCollection(row);\n\n    }\n\n    LevelControl.prototype.getLevelDescriptors = function (parentid, criteria) {\n\n      const row = document.getElementById(parentid);\n      const criterion = FeditorHelper.getCriterionFromCriteriaCollection(row, criteria);\n\n      // Get the level to add the descriptor\n      const levelsdesc = criterion[0].levels.filter(function (level, index) {\n        if (parentid == level.id) {\n          return level.descriptors;\n        }\n      }, parentid);\n\n      return levelsdesc;\n    }\n\n    LevelControl.prototype.getMinMaxMark = function (score) {\n\n      if (score.indexOf('-') != -1) {\n        return score.split('-');\n      } else {\n        return score.split('/');\n      }\n    }\n\n    LevelControl.prototype.setErrorMessage = function (e, message) {\n      Log.debug(message);\n\n\n      e.target.classList.add('total-input-error');\n      e.target.setAttribute('data-toggle', 'tooltip');\n      e.target.setAttribute('data-placement', 'right');\n      e.target.setAttribute('data-title', message);\n    }\n\n    LevelControl.prototype.validatePreviousMarkValue = function () {\n      const self = this;\n\n      const previousLevel = document.getElementById(self.id).previousElementSibling;\n      const previousMark = previousLevel.querySelector('.fmark');\n      Log.debug(\"previousMark\");\n      if (previousMark != null && previousMark.value == 0 && previousMark.value != \"\") {\n        Log.debug(previousMark.value);\n\n        previousLevel.classList.add('alert-warning');\n        previousMark.insertAdjacentHTML('afterend', '<small>Change Mark</small>');\n\n      }\n\n    }\n\n    LevelControl.prototype.cleanPreviousMarkWarning = function () {\n      const self = this;\n\n      const level = document.getElementById(self.id);\n      if ( level.classList.contains('alert-warning')) {\n        level.classList.remove('alert-warning');\n        level.querySelector('.level-mark').removeChild(level.querySelector('small'));\n      }\n\n    }\n\n\n\n\n\n\n    return {\n      init: init\n    };\n  });"],"file":"level_control.min.js"}