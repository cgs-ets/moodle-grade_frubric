function _slicedToArray(a,b){return _arrayWithHoles(a)||_iterableToArrayLimit(a,b)||_unsupportedIterableToArray(a,b)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(a,b){if(!a)return;if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);if("Object"===c&&a.constructor)c=a.constructor.name;if("Map"===c||"Set"===c)return Array.from(c);if("Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return _arrayLikeToArray(a,b)}function _arrayLikeToArray(a,b){if(null==b||b>a.length)b=a.length;for(var c=0,d=Array(b);c<b;c++){d[c]=a[c]}return d}function _iterableToArrayLimit(a,b){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(a)))return;var c=[],d=!0,e=!1,f=void 0;try{for(var g=a[Symbol.iterator](),h;!(d=(h=g.next()).done);d=!0){c.push(h.value);if(b&&c.length===b)break}}catch(a){e=!0;f=a}finally{try{if(!d&&null!=g["return"])g["return"]()}finally{if(e)throw f}}return c}function _arrayWithHoles(a){if(Array.isArray(a))return a}define ("gradingform_frubric/criterion_control",["core/log","core/templates","core/str","core/notification","gradingform_frubric/level_control","gradingform_frubric/feditor_helper"],function(a,b,c,d,e,f){'use strict';function g(a,b){var c=this;c.LEVEL_ROW="gradingform_frubric/editor_level_row";c.mode=a;c.id=b}g.prototype.main=function(){var b=this,c=document.getElementById(b.id);if("edit"==b.mode){try{b.setupEvents(c);c.getAttribute("data-criterion-group");e.init(b.id)}catch(b){a.debug(b)}}else{b.setupEvents(c)}};g.prototype.setupEvents=function(a){var b=this,c=a.querySelector(".act");if(!c){return}var d=c.children;d[0].addEventListener("click",b.removeCriterion.bind(a));d[1].addEventListener("click",b.addLevel.bind(b,a));var e=a.querySelector(".crit-desc");e.addEventListener("click",b.editCriterionDescription.bind(this));e.addEventListener("focusout",b.focusoutHandlerDisabled);var g=f.getNextElement(a,".result-r");if(g!=void 0){var h=_slicedToArray(g.children,2),i=h[0],j=h[1];j.querySelector(".total-input").addEventListener("blur",b.validateTotal)}};g.prototype.addLevel=function(c){var d=this,g=f.getRandomID(),h={score:"Click to edit Mark",definition:"Click to edit Level description",criteriongroupid:c.getAttribute("data-criterion-group"),id:g};b.render(d.LEVEL_ROW,h).done(function(a){var b,h=".level-".concat(c.getAttribute("data-criterion-group")),i=f.getNextElement(c,".criterion-header");if(i!=void 0){var l=f.getPreviousElement(i,".result-r");b=f.getPreviousElement(l,h);if(b==void 0){b=c}}else{var m=f.getNextElement(c,".result-r");b=f.getPreviousElement(m,h);if(b==void 0){b=c}Y.log(b.classList);if(b.classList.contains("border-danger-fr")){b.classList.remove("border-danger-fr")}}b.insertAdjacentHTML("afterend",a);var j=f.getCriteriaJSON(),k=f.getCriterionFromCriteriaCollection(c,j);k[0].levels.push({score:0,status:"NEW",id:g,descriptors:[]});f.setCriteriaJSON(j);f.setHiddenCriteriaJSON(j);e.init(g,d.id)}).fail(function(b){a.debug("error...");a.debug(b)})};g.prototype.removeCriterion=function(a){c.get_strings([{key:"confirm",component:"gradingform_frubric"},{key:"confirmdeletecriterion",component:"gradingform_frubric"},{key:"yes"},{key:"no"}]).done(function(b){d.confirm(b[0],b[1],b[2],b[3],function(){var b=document.getElementById("criteriaTable"),c=a.target.parentNode.parentNode.parentNode.parentNode.rowIndex,d=a.target.parentNode.parentNode.parentNode.parentNode.getAttribute("data-criterion-group"),e=JSON.parse(document.getElementById("id_criteria").value),g=e.filter(function(a,b){var c=this.getAttribute("data-criterion-group");a.rowindex=b;if(c==a.id){return a}},a.target.parentNode.parentNode.parentNode.parentNode);g[0].status="DELETE";for(var h=g[0].levels,k=0;k<h.length;k++){h[k].status="DELETE"}f.setCriteriaJSON(e);f.setHiddenCriteriaJSON(e);for(var l=c+1;l<b.rows.length;l++){if(b.rows[l].getAttribute("data-criterion-group")==d){b.rows[l].classList.add("to-remove")}else{break}}(function(a){var b=document.getElementsByClassName(a);while(0<b.length){b[0].parentNode.removeChild(b[0])}})("to-remove");b.deleteRow(c)},function(){})})};g.prototype.editCriterionDescription=function(b){b.stopPropagation();a.debug("edit criterion description");var c=b.target;c.removeAttribute("disabled");c.focus();c.addEventListener("change",this.changeCriterionHandlerDisabled.bind(this))};g.prototype.focusoutHandlerDisabled=function(a){a.target.setAttribute("disabled",!0)};g.prototype.changeCriterionHandlerDisabled=function(a){var b=document.getElementById("id_criteria").value?JSON.parse(document.getElementById("id_criteria").value):[],c=b.filter(function(b,c){var d=a.target.parentNode.parentNode.getAttribute("data-criterion-group");b.rowindex=c;if(d==b.id){return b}},a);if(c[0].description!=a.target.value&&"edit"==f.getMode()&&!c[0].cid.includes("frubric-criteria-NEWID")){c[0].status="UPDATE"}c[0].description=a.target.value;f.setCriteriaJSON(b);f.setHiddenCriteriaJSON(b);if(a.target.classList.contains("border-danger-fr")){a.target.classList.remove("border-danger-fr")}};g.prototype.getCriteriaJSON=function(){return document.getElementById("id_criteria").value?JSON.parse(document.getElementById("id_criteria").value):[]};g.prototype.validateTotal=function(a){a.target.classList.remove("total-input-error");a.target.removeAttribute("data-toggle");a.target.removeAttribute("data-placement");a.target.removeAttribute("data-title");var b=a.target.valueAsNumber,c=a.target.getAttribute("min"),d=a.target.getAttribute("max");if(b!=NaN&&(b<c||b>d)){a.target.classList.add("total-input-error");a.target.setAttribute("data-toggle","tooltip");a.target.setAttribute("data-placement","right");a.target.setAttribute("data-title","Value out of range")}else{var e=f.getCriteriaJSON(),g=f.getCriterionFromCriteriaCollection(a.target.parentNode.parentNode.parentNode,e);g[0].sumscore=b;f.setCriteriaJSON(e);f.setHiddenCriteriaJSON(e)}};return{init:function(b){a.debug("Criterion control...");var c=f.getMode(),d=new g(c,b);d.main()}}});
//# sourceMappingURL=criterion_control.min.js.map
