function _slicedToArray(a,b){return _arrayWithHoles(a)||_iterableToArrayLimit(a,b)||_unsupportedIterableToArray(a,b)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(a,b){if(!a)return;if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);if("Object"===c&&a.constructor)c=a.constructor.name;if("Map"===c||"Set"===c)return Array.from(c);if("Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return _arrayLikeToArray(a,b)}function _arrayLikeToArray(a,b){if(null==b||b>a.length)b=a.length;for(var c=0,d=Array(b);c<b;c++){d[c]=a[c]}return d}function _iterableToArrayLimit(a,b){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(a)))return;var c=[],d=!0,e=!1,f=void 0;try{for(var g=a[Symbol.iterator](),h;!(d=(h=g.next()).done);d=!0){c.push(h.value);if(b&&c.length===b)break}}catch(a){e=!0;f=a}finally{try{if(!d&&null!=g["return"])g["return"]()}finally{if(e)throw f}}return c}function _arrayWithHoles(a){if(Array.isArray(a))return a}define ("gradingform_frubric/criterion_control",["jquery","core/log","core/templates","core/ajax","core/str","core/notification","gradingform_frubric/level_control","gradingform_frubric/feditor_helper"],function(a,b,c,d,e,f,g,h){'use strict';function i(a,b){var c=this;c.LEVEL_ROW="gradingform_frubric/editor_level_row";c.mode=a;c.id=b}i.prototype.main=function(){var a=this,c=document.getElementById(a.id);if("edit"==a.mode){try{a.setupEvents(c);c.getAttribute("data-criterion-group");g.init(a.id)}catch(a){b.debug(a)}}else{a.setupEvents(c)}};i.prototype.setupEvents=function(a){var b=this,c=a.querySelector(".act");if(!c){return}var d=c.children;d[0].addEventListener("click",b.removeCriterion.bind(a));d[1].addEventListener("click",b.addLevel.bind(b,a));var e=a.querySelector(".crit-desc");e.addEventListener("click",b.editCriterionDescription.bind(this));e.addEventListener("focusout",b.focusoutHandlerDisabled);var f=h.getNextElement(a,".result-r");if(f!=void 0){var g=_slicedToArray(f.children,2),i=g[0],j=g[1];j.querySelector(".total-input").addEventListener("blur",b.validateTotal)}};i.prototype.addLevel=function(a){var d=this,e=h.getRandomID(),f={score:"Click to edit Mark",definition:"Click to edit Level description",criteriongroupid:a.getAttribute("data-criterion-group"),id:e};c.render(d.LEVEL_ROW,f).done(function(b){var c,f=".level-".concat(a.getAttribute("data-criterion-group")),i=h.getNextElement(a,".criterion-header");if(i!=void 0){var l=h.getPreviousElement(i,".result-r");c=h.getPreviousElement(l,f);if(c==void 0){c=a}}else{var m=h.getNextElement(a,".result-r");c=h.getPreviousElement(m,f);if(c==void 0){c=a}}c.insertAdjacentHTML("afterend",b);var j=h.getCriteriaJSON(),k=h.getCriterionFromCriteriaCollection(a,j);k[0].levels.push({score:0,status:"NEW",id:e,descriptors:[]});h.setCriteriaJSON(j);g.init(e,d.id)}).fail(function(a){b.debug("error...");b.debug(a)})};i.prototype.removeCriterion=function(a){e.get_strings([{key:"confirm",component:"gradingform_frubric"},{key:"confirmdeletecriterion",component:"gradingform_frubric"},{key:"yes"},{key:"no"}]).done(function(b){f.confirm(b[0],b[1],b[2],b[3],function(){var b=document.getElementById("criteriaTable"),c=a.target.parentNode.parentNode.parentNode.parentNode.rowIndex,d=a.target.parentNode.parentNode.parentNode.parentNode.getAttribute("data-criterion-group"),e=JSON.parse(document.getElementById("id_criteria").value),f=e.filter(function(a,b){var c=this.getAttribute("data-criterion-group");a.rowindex=b;if(c==a.id){return a}},a.target.parentNode.parentNode.parentNode.parentNode);f[0].status="DELETE";for(var g=f[0].levels,h=0;h<g.length;h++){g[h].status="DELETE"}document.getElementById("id_criteria").value=JSON.stringify(e);for(var k=c+1;k<b.rows.length;k++){if(b.rows[k].getAttribute("data-criterion-group")==d){b.rows[k].classList.add("to-remove")}else{break}}(function(a){var b=document.getElementsByClassName(a);while(0<b.length){b[0].parentNode.removeChild(b[0])}})("to-remove");b.deleteRow(c)},function(){})})};i.prototype.copyCriterion=function(){b.debug("copyCriterion")};i.prototype.editCriterionDescription=function(a){a.stopPropagation();b.debug("edit criterion description");var c=a.target;c.removeAttribute("disabled");c.focus();c.addEventListener("change",this.changeCriterionHandlerDisabled.bind(this))};i.prototype.focusoutHandlerDisabled=function(a){a.target.setAttribute("disabled",!0)};i.prototype.changeCriterionHandlerDisabled=function(a){var b=document.getElementById("id_criteria").value?JSON.parse(document.getElementById("id_criteria").value):[],c=b.filter(function(b,c){var d=a.target.parentNode.parentNode.getAttribute("data-criterion-group");b.rowindex=c;if(d==b.id){return b}},a);if(c[0].description!=a.target.value&&"edit"==h.getMode()&&!c[0].cid.includes("frubric-criteria-NEWID")){c[0].status="UPDATE"}c[0].description=a.target.value;document.getElementById("id_criteria").value=JSON.stringify(b)};i.prototype.getCriteriaJSON=function(){return document.getElementById("id_criteria").value?JSON.parse(document.getElementById("id_criteria").value):[]};i.prototype.validateTotal=function(a){a.target.classList.remove("total-input-error");a.target.removeAttribute("data-toggle");a.target.removeAttribute("data-placement");a.target.removeAttribute("data-title");var b=a.target.valueAsNumber,c=a.target.getAttribute("min"),d=a.target.getAttribute("max");if(b!=NaN&&(b<c||b>d)){a.target.classList.add("total-input-error");a.target.setAttribute("data-toggle","tooltip");a.target.setAttribute("data-placement","right");a.target.setAttribute("data-title","Value out of range")}else{var e=h.getCriteriaJSON(),f=h.getCriterionFromCriteriaCollection(a.target.parentNode.parentNode.parentNode,e);f[0].sumscore=b;h.setCriteriaJSON(e)}};return{init:function(a){b.debug("Criterion control...");var c=h.getMode(),d=new i(c,a);d.main()}}});
//# sourceMappingURL=criterion_control.min.js.map
